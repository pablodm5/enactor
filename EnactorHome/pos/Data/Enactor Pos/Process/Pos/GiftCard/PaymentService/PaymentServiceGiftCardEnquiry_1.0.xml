<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<core:process xmlns:core="http://www.enactor.com/core" xmlns:retail="http://www.enactor.com/retail" xmlns:ns4="http://www.enactor.com/crm" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:ns6="http://www.apis-it.hr/fin/2012/types/f73" xmlns:ns7="http://www.w3.org/2000/09/xmldsig#" xmlns:ns8="http://www.enactor.com/retail/storedRetailTransaction/service" xmlns:ns9="http://www.fu.gov.si/" xmlns:ns10="http://www.enactor.com/addressLookup/service" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:ns14="http://www.enactor.com/crm/customerLoyalty/service" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <core:processID>Pos/GiftCard/PaymentService/PaymentServiceGiftCardEnquiry</core:processID>
    <core:version>1.0</core:version>
    <core:name></core:name>
    <core:defaultMessageBaseName></core:defaultMessageBaseName>
    <core:firstStateID>Start</core:firstStateID>
    <core:className></core:className>
    <core:uiHints>
        <entry>
            <key>com.enactor.tools.editor.process.style</key>
            <value>2047</value>
        </entry>
        <entry>
            <key>com.enactor.tools.editor.process.xloc</key>
            <value>8</value>
        </entry>
        <entry>
            <key>com.enactor.tools.editor.process.yloc</key>
            <value>8</value>
        </entry>
    </core:uiHints>
    <core:metaData>
        <core:inputs>
            <core:input name="PaymentService">
                <core:interfaceName>com.enactor.paymentService.IPaymentService</core:interfaceName>
            </core:input>
            <core:input name="enactor.paymentService.KeyedCardAllowedPrivilegeId">
                <core:interfaceName>java.lang.String</core:interfaceName>
            </core:input>
            <core:input name="enactor.paymentService.KeyedCardAuthorisesPrivilegeId">
                <core:interfaceName>java.lang.String</core:interfaceName>
            </core:input>
            <core:input name="enactor.coreUI.User">
                <core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
            </core:input>
            <core:input name="enactor.mfc.GiftCardDetails">
                <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
            </core:input>
            <core:input name="enactor.paymentService.CardInsertMessage">
                <core:interfaceName>java.lang.String</core:interfaceName>
            </core:input>
            <core:input name="enactor.pos.IsKeyed">
                <core:interfaceName>java.lang.Boolean</core:interfaceName>
            </core:input>
            <core:input name="enactor.mfc.GiftCardType">
                <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
            </core:input>
            <core:input name="enactor.mfc.Location">
                <core:interfaceName>com.enactor.mfc.location.ILocation</core:interfaceName>
            </core:input>
            <core:input name="enactor.mfc.PosTerminal">
                <core:interfaceName>com.enactor.mfc.posTerminal.IPOSTerminal</core:interfaceName>
            </core:input>
            <core:input name="enactor.mfc.TransactionHandler">
                <core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
            </core:input>
        </core:inputs>
        <core:outputs>
            <core:output required="true" name="enactor.cardAuthorisation.messages.GiftCardBalanceResponse">
                <core:interfaceName>com.enactor.cardAuthorisation.messages.giftCard.IGiftCardBalanceResponse</core:interfaceName>
            </core:output>
            <core:output required="true" name="enactor.mfc.GiftCardDetails">
                <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
            </core:output>
            <core:output required="false" name="enactor.mfc.GiftCardType">
                <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
            </core:output>
            <core:output required="true" name="enactor.mfc.IINRange">
                <core:interfaceName>com.enactor.mfc.iinRange.IIINRange</core:interfaceName>
            </core:output>
        </core:outputs>
        <stateDataTypes>
            <stateDataType name="enactor.pos.IsKeyed">
                <core:interfaceName>java.lang.Boolean</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.mfc.GiftCardType">
                <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.paymentService.CardInsertMessage">
                <core:interfaceName>java.lang.String</core:interfaceName>
            </stateDataType>
            <stateDataType required="true" name="enactor.coreUI.AuthorisingUser">
                <core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.coreUI.User">
                <core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
            </stateDataType>
            <stateDataType required="true" name="enactor.paymentService.BalanceEnquiryResponse">
                <core:interfaceName>com.enactor.paymentService.IBalanceEnquiryResponse</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.mfc.GiftCardDetails">
                <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.mfc.TransactionHandler">
                <core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.mfc.Location">
                <core:interfaceName>com.enactor.mfc.location.ILocation</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.mfc.PosTerminal">
                <core:interfaceName>com.enactor.mfc.posTerminal.IPOSTerminal</core:interfaceName>
            </stateDataType>
            <stateDataType required="true" name="enactor.cardAuthorisation.messages.GiftCardBalanceResponse">
                <core:interfaceName>com.enactor.cardAuthorisation.messages.giftCard.IGiftCardBalanceResponse</core:interfaceName>
            </stateDataType>
            <stateDataType name="PaymentService">
                <core:interfaceName>com.enactor.paymentService.IPaymentService</core:interfaceName>
            </stateDataType>
            <stateDataType required="true" name="enactor.mfc.IINRange">
                <core:interfaceName>com.enactor.mfc.iinRange.IIINRange</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.paymentService.KeyedCardAllowedPrivilegeId">
                <core:interfaceName>java.lang.String</core:interfaceName>
            </stateDataType>
            <stateDataType name="enactor.paymentService.KeyedCardAuthorisesPrivilegeId">
                <core:interfaceName>java.lang.String</core:interfaceName>
            </stateDataType>
        </stateDataTypes>
    </core:metaData>
    <core:notes>
        <core:processNote>
            <core:noteId>Note0</core:noteId>
            <core:description>Fail from LoadIINAndGiftCardType should continue as normal since all information required for the enquiry are already loaded from the payment service.</core:description>
            <core:constraint>
                <core:x>2743</core:x>
                <core:y>366</core:y>
                <core:height>142</core:height>
                <core:width>280</core:width>
            </core:constraint>
        </core:processNote>
    </core:notes>
    <core:action>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>LogException</core:actionID>
        <core:name>UILogMessageAction</core:name>
        <core:className>com.enactor.coreUI.actions.UILogMessageAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>272</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>93</value>
            </entry>
        </core:uiHints>
        <core:param value="Error in Cash Tender" name="enactor.coreUI.LogMessage">
            <core:interfaceName>java.lang.String</core:interfaceName>
        </core:param>
        <core:metaData>
            <core:inputs>
                <core:input name="enactor.coreUI.LogMessage">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outcomes>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID>ProcessError</core:toStateID>
            <core:toActionID></core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID>ProcessError</core:toStateID>
            <core:toActionID></core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Exception</core:outcome>
        </core:outcomeLink>
    </core:action>
    <core:endProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>EndProcessFail</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UIEndProcessAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>559</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>14</value>
            </entry>
        </core:uiHints>
        <core:metaData/>
        <core:typeId>enactor.types.EndProcess</core:typeId>
        <core:outcome>Fail</core:outcome>
        <core:defaultProcessId></core:defaultProcessId>
    </core:endProcessAction>
    <core:endProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>EndProcessCancel</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UIEndProcessAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>931</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>14</value>
            </entry>
        </core:uiHints>
        <core:metaData/>
        <core:typeId>enactor.types.EndProcess</core:typeId>
        <core:outcome>Cancel</core:outcome>
        <core:defaultProcessId></core:defaultProcessId>
    </core:endProcessAction>
    <core:endProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>EndProcessSuccess</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UIEndProcessAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>2955</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>9</value>
            </entry>
        </core:uiHints>
        <core:metaData/>
        <core:typeId>enactor.types.EndProcess</core:typeId>
        <core:outcome>Success</core:outcome>
        <core:defaultProcessId></core:defaultProcessId>
    </core:endProcessAction>
    <core:executeProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>CheckAllowed</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.CallProcessWithPrivilegesAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>103</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>155</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>625</value>
            </entry>
        </core:uiHints>
        <core:privileges>enactor.pos.PaymentServiceGiftCardEnquiryAllowed</core:privileges>
        <core:metaData>
            <core:outcomes>
                <core:outcome name="Success"/>
                <core:outcome name="Fail"/>
            </core:outcomes>
        </core:metaData>
        <core:comment>Refund onto a gift card (NOT refund a gift card)</core:comment>
        <core:typeId>CheckAllowed</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessFail</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Fail</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>Authorise</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:executeProcessId>Pos/Common/CheckAllowed</core:executeProcessId>
    </core:executeProcessAction>
    <core:executeProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>Authorise</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.CallProcessWithPrivilegesAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>127</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>400</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>620</value>
            </entry>
        </core:uiHints>
        <core:privileges>enactor.pos.AuthorisesPaymentServiceGiftCardEnquiry</core:privileges>
        <core:metaData>
            <core:inputs>
                <core:input required="false" name="enactor.coreUI.User">
                    <core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="false" name="enactor.coreUI.AuthorisingUser">
                    <core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Success"/>
                <core:outcome name="Cancel"/>
                <core:outcome name="Fail"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>Authorise</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessCancel</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Cancel</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID>UserNotAuthorised</core:toStateID>
            <core:toActionID></core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Fail</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>3</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>Call PaymentServiceBalanceEnquiry</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>4</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>GetGiftCardDetails</core:toActionID>
            <core:condition>strings:startsWith(process.paymentService.model, 'ESocket')</core:condition>
            <core:comment>ESocket Payment Service takes Card Details in</core:comment>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:executeProcessId>Pos/SignOn/CheckAuthorisation</core:executeProcessId>
    </core:executeProcessAction>
    <core:assignAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>SetGiftCardBalanceResponse</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UIAssignAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>27</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>2147</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>577</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <core:inputs>
                <core:input required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.paymentService.BalanceEnquiryResponse">
                    <core:interfaceName>com.enactor.paymentService.IBalanceEnquiryResponse</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.cardAuthorisation.messages.GiftCardBalanceResponse">
                    <core:interfaceName>com.enactor.cardAuthorisation.messages.giftCard.IGiftCardBalanceResponse</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.GiftCardType">
                    <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
                </core:input>
                <core:input required="true" name="PaymentService">
                    <core:interfaceName>com.enactor.paymentService.IPaymentService</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:output>
                <core:output required="true" name="enactor.cardAuthorisation.messages.GiftCardBalanceResponse">
                    <core:interfaceName>com.enactor.cardAuthorisation.messages.giftCard.IGiftCardBalanceResponse</core:interfaceName>
                </core:output>
                <core:output required="true" name="enactor.paymentService.CardDetailsFull">
                    <core:interfaceName>com.enactor.paymentService.ICardDetailsFull</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.Assign</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>SetGiftCardExpiryDate</core:toActionID>
            <core:condition>notEmpty(process.balanceEnquiryResponse.cardDetails.expiryDate)</core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>IsFullPan</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:dataAssignment toExpression="giftCardBalanceResponse.authorisationCode" fromExpression="balanceEnquiryResponse.authorisationCode"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.hostResponseCode" fromExpression="strings:isNumericAndNotEmpty(balanceEnquiryResponse.authorisationResponseCode) ? balanceEnquiryResponse.authorisationResponseCode : 0"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.hostReference" fromExpression="balanceEnquiryResponse.captureReference"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.transactionCurrencyId" fromExpression="balanceEnquiryResponse.currencyId"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.terminalId" fromExpression="balanceEnquiryResponse.eftTerminalId"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.deviceId" fromExpression="balanceEnquiryResponse.deviceId"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.balance" fromExpression="balanceEnquiryResponse.amount"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.transactionDateTime" fromExpression="balanceEnquiryResponse.transactionDate"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.expiryDate" fromExpression="notEmpty(balanceEnquiryResponse.cardDetails.expiryDate) ? dates:getMonthEnd(dates:parseYYMM(balanceEnquiryResponse.cardDetails.expiryDate)) : null"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.dateActivated" fromExpression="dates:parseYYMM(balanceEnquiryResponse.cardDetails.startDate)"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.decline" fromExpression="balanceEnquiryResponse.outcome =='Success' ? false : true"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.accountId" fromExpression="balanceEnquiryResponse.cardDetails.mangledPAN"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.giftCardDescription" fromExpression="isEmpty(balanceEnquiryResponse.cardDetails.cardDescription) ? balanceEnquiryResponse.cardDetails.cardScheme : balanceEnquiryResponse.cardDetails.cardDescription"/>
        <core:dataAssignment toExpression="giftCardDetails.eftTerminalId" fromExpression="balanceEnquiryResponse.eftTerminalId"/>
        <core:dataAssignment toExpression="giftCardDetails.merchantId" fromExpression="balanceEnquiryResponse.eftMerchantId"/>
        <core:dataAssignment toExpression="giftCardDetails.currencyId" fromExpression="balanceEnquiryResponse.currencyId"/>
        <core:dataAssignment toExpression="giftCardBalanceResponse.status" fromExpression="'ACTIVE'"/>
        <core:dataAssignment toExpression="giftCardDetails.accountId" fromExpression="balanceEnquiryResponse.cardDetails.mangledPAN"/>
        <core:dataAssignment toExpression="giftCardDetails.newBalance" fromExpression="balanceEnquiryResponse.amount"/>
        <core:dataAssignment toExpression="giftCardDetails.cardDetails.balance" fromExpression="balanceEnquiryResponse.amount"/>
        <core:dataAssignment toExpression="giftCardDetails.previousBalance" fromExpression="balanceEnquiryResponse.amount"/>
        <core:dataAssignment toExpression="giftCardDetails.hostReference" fromExpression="balanceEnquiryResponse.captureReference"/>
        <core:dataAssignment toExpression="giftCardDetails.giftCardTypeId" fromExpression="giftCardType.giftCardTypeId"/>
        <core:dataAssignment toExpression="giftCardDetails.paymentServiceType" fromExpression="paymentService.model"/>
        <core:dataAssignment toExpression="cardDetailsFull" fromExpression="instanceOf(balanceEnquiryResponse.cardDetails, 'com.enactor.paymentService.ICardDetailsFull') ? balanceEnquiryResponse.cardDetails : null"/>
    </core:assignAction>
    <core:action>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>GiftCardBalanceResponse</core:actionID>
        <core:name>CreateEntityAction</core:name>
        <core:className>com.enactor.coreUI.actions.CreateEntityAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1023</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>1339</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>577</value>
            </entry>
        </core:uiHints>
        <core:param value="giftCardBalanceResponse" name="enactor.coreUI.EntityName">
            <core:interfaceName>java.lang.String</core:interfaceName>
        </core:param>
        <core:param value="http://www.enactor.com/retail" name="enactor.coreUI.EntityNamespace">
            <core:interfaceName>java.lang.String</core:interfaceName>
        </core:param>
        <core:metaData>
            <core:inputs>
                <core:input required="true" name="enactor.coreUI.EntityName">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.coreUI.EntityNamespace">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output name="enactor.coreUI.Entity">
                    <core:interfaceName>com.enactor.core.entities.IEntity</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>CopyCardDetails</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
    </core:action>
    <core:executeProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>GetGiftCardDetails</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UICallProcessAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1023</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>668</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>354</value>
            </entry>
        </core:uiHints>
        <core:param value="true" name="enactor.pos.AllowAlreadyUsed">
            <core:interfaceName>java.lang.Boolean</core:interfaceName>
        </core:param>
        <core:metaData>
            <core:inputs>
                <core:input name="enactor.mfc.GiftCardType">
                    <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
                </core:input>
                <core:input name="enactor.coreUI.User">
                    <core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
                </core:input>
                <core:input name="enactor.pos.CardNumberScanned">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
                <core:input name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:input>
                <core:input name="enactor.pos.CardTrack2">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.TransactionHandler">
                    <core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
                </core:input>
                <core:input name="enactor.pos.AllowAlreadyUsed">
                    <core:interfaceName>java.lang.Boolean</core:interfaceName>
                </core:input>
                <core:input name="enactor.mfc.Location">
                    <core:interfaceName>com.enactor.mfc.location.ILocation</core:interfaceName>
                </core:input>
                <core:input name="enactor.mfc.PosTerminal">
                    <core:interfaceName>com.enactor.mfc.posTerminal.IPOSTerminal</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="true" name="enactor.mfc.GiftCardType">
                    <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
                </core:output>
                <core:output required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Cancel"/>
                <core:outcome name="Success"/>
                <core:outcome name="Fail"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.CallProcess</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessCancel</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Cancel</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessFail</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Fail</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>3</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>SetPaymentServiceMessage</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:executeProcessId>Pos/GiftCard/GetGiftCardDetails</core:executeProcessId>
    </core:executeProcessAction>
    <core:assignAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>SetPaymentServiceMessage</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UIAssignAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>803</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>216</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <core:inputs>
                <core:input required="true" name="enactor.paymentService.CardInsertMessage">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="true" name="enactor.paymentService.CardInsertMessage">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.Assign</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>Call PaymentServiceBalanceEnquiry</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:dataAssignment toExpression="cardInsertMessage" fromExpression="'GIFT_CARD_INQUIRY_WAIT'"/>
    </core:assignAction>
    <core:executeProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>Call PaymentServiceBalanceEnquiry</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UICallExtensionPointProcessAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>27</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>935</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>354</value>
            </entry>
        </core:uiHints>
        <core:param value="PaymentServiceBalanceEnquiry" name="enactor.coreUI.ExtensionPointId">
            <core:interfaceName>java.lang.String</core:interfaceName>
        </core:param>
        <core:metaData>
            <core:inputs>
                <core:input required="true" name="PaymentService">
                    <core:interfaceName>com.enactor.paymentService.IPaymentService</core:interfaceName>
                </core:input>
                <core:input name="enactor.paymentService.KeyedCardAuthorisesPrivilegeId">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
                <core:input name="enactor.paymentService.KeyedCardAllowedPrivilegeId">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.coreUI.UserLocale">
                    <core:interfaceName>com.enactor.core.localisation.ILocale</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.coreUI.User">
                    <core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.Location">
                    <core:interfaceName>com.enactor.mfc.location.ILocation</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.Device">
                    <core:interfaceName>com.enactor.mfc.device.IDevice</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.paymentService.CardInsertMessage">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.pos.CurrentlyInTrainingMode">
                    <core:interfaceName>java.lang.Boolean</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.PosTerminal">
                    <core:interfaceName>com.enactor.mfc.posTerminal.IPOSTerminal</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.BaseCurrency">
                    <core:interfaceName>com.enactor.mfc.currency.ICurrency</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.pos.IsKeyed">
                    <core:interfaceName>java.lang.Boolean</core:interfaceName>
                </core:input>
                <core:input name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.coreUI.ExtensionPointId">
                    <core:interfaceName>java.lang.String</core:interfaceName>
                </core:input>
                <core:input required="false" name="enactor.mfc.GiftCardType">
                    <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.TransactionHandler">
                    <core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="true" name="enactor.paymentService.BalanceEnquiryResponse">
                    <core:interfaceName>com.enactor.paymentService.IBalanceEnquiryResponse</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="ServiceFail"/>
                <core:outcome name="ServiceCancel"/>
                <core:outcome name="ServiceComplete"/>
                <core:outcome name="enactor.action.StopExtensionLinking"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.CallProcess</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessCancel</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>ServiceCancel</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>GiftCardBalanceResponse</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>ServiceComplete</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>3</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessFail</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>ServiceFail</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>4</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>GiftCardBalanceResponse</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>enactor.action.StopExtensionLinking</core:outcome>
        </core:outcomeLink>
        <core:executeProcessId></core:executeProcessId>
    </core:executeProcessAction>
    <core:action>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>CopyCardDetails</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.pos.packages.paymentService.CopyResponseCardDetailsToItemCardDetails</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>27</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>1743</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>577</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <core:inputs>
                <core:input name="enactor.paymentService.PaymentServiceResponse">
                    <core:interfaceName>com.enactor.paymentService.IPaymentServiceResponse</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.BasketItem">
                    <core:interfaceName>com.enactor.mfc.basket.items.IBasketItem</core:interfaceName>
                </core:input>
                <core:input name="enactor.mfc.CardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.ICardDetails</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.TransactionHandler">
                    <core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.coreUI.UserLocale">
                    <core:interfaceName>com.enactor.core.localisation.ILocale</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output name="enactor.mfc.BasketItem">
                    <core:interfaceName>com.enactor.mfc.basket.items.IBasketItem</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Success"/>
                <core:outcome name="Fail"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.BasicAction</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>SetGiftCardBalanceResponse</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>SetGiftCardBalanceResponse</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Fail</core:outcome>
        </core:outcomeLink>
    </core:action>
    <core:assignAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>FullPan</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UIAssignAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>27</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>2562</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>1143</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <core:inputs>
                <core:input required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.paymentService.CardDetailsFull">
                    <core:interfaceName>com.enactor.paymentService.ICardDetailsFull</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.Assign</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>LoadIINAndGiftCardType</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:dataAssignment toExpression="giftCardDetails.accountId" fromExpression="cardDetailsFull.cardNumber"/>
        <core:dataAssignment toExpression="giftCardDetails.cardDetails.PANIIN" fromExpression="null"/>
    </core:assignAction>
    <core:executeProcessAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>LoadIINAndGiftCardType</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UICallProcessAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.notes</key>
                <value>Note0</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>27</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>2955</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>577</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <core:inputs>
                <core:input required="false" name="enactor.mfc.GiftCardType">
                    <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.mfc.Location">
                    <core:interfaceName>com.enactor.mfc.location.ILocation</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="false" name="enactor.mfc.GiftCardType">
                    <core:interfaceName>com.enactor.mfc.giftCardType.IGiftCardType</core:interfaceName>
                </core:output>
                <core:output required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:output>
                <core:output required="false" name="enactor.mfc.IINRange">
                    <core:interfaceName>com.enactor.mfc.iinRange.IIINRange</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Cancel"/>
                <core:outcome name="Fail"/>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.CallProcess</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessCancel</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Cancel</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessSuccess</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Fail</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>3</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessSuccess</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:executeProcessId>Pos/GiftCard/LoadIINAndGiftCardType</core:executeProcessId>
    </core:executeProcessAction>
    <core:assignAction>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>SetGiftCardExpiryDate</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UIAssignAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>27</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>2147</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>1143</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <core:inputs>
                <core:input required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:input>
                <core:input required="true" name="enactor.paymentService.BalanceEnquiryResponse">
                    <core:interfaceName>com.enactor.paymentService.IBalanceEnquiryResponse</core:interfaceName>
                </core:input>
            </core:inputs>
            <core:outputs>
                <core:output required="true" name="enactor.mfc.GiftCardDetails">
                    <core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                </core:output>
            </core:outputs>
            <core:outcomes>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.Assign</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>IsFullPan</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:dataAssignment toExpression="giftCardDetails.expiryDate" fromExpression="dates:getMonthEnd(dates:parseYYMM(balanceEnquiryResponse.cardDetails.expiryDate))"/>
    </core:assignAction>
    <core:action>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:actionID>IsFullPan</core:actionID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.actions.UINullAction</core:className>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>2562</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>577</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <core:outcomes>
                <core:outcome name="Success"/>
            </core:outcomes>
        </core:metaData>
        <core:typeId>enactor.types.NullAction</core:typeId>
        <core:outcomeLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>FullPan</core:toActionID>
            <core:condition>notEmpty(state.cardDetailsFull) &amp;&amp; strings:isNumericAndNotEmpty(state.cardDetailsFull.cardNumber)</core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
        <core:outcomeLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>LoadIINAndGiftCardType</core:toActionID>
            <core:condition></core:condition>
            <core:outcome>Success</core:outcome>
        </core:outcomeLink>
    </core:action>
    <core:eventLink>
        <core:linkID>1</core:linkID>
        <core:toStateID></core:toStateID>
        <core:toActionID>LogException</core:toActionID>
        <core:condition></core:condition>
        <core:event>Exception</core:event>
    </core:eventLink>
    <core:messageState>
        <core:url>/Error/Error</core:url>
        <core:stateID>ProcessError</core:stateID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.states.UIErrorState</core:className>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>272</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>17</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <handledEvents>
                <handledEvent name="OKPressed"/>
            </handledEvents>
        </core:metaData>
        <core:typeId>ExceptionMessage</core:typeId>
        <core:singleInstance>false</core:singleInstance>
        <core:respondToViewEvents>false</core:respondToViewEvents>
        <core:actionInputMappings/>
        <core:actionOutputMappings/>
        <core:eventLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessFail</core:toActionID>
            <core:condition></core:condition>
            <core:event>Exception</core:event>
        </core:eventLink>
        <core:eventLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessFail</core:toActionID>
            <core:condition></core:condition>
            <core:event>OKPressed</core:event>
        </core:eventLink>
        <core:keepPromptOpen>false</core:keepPromptOpen>
        <core:keepPreviousPromptOpen>false</core:keepPreviousPromptOpen>
        <core:promptTimeout>0</core:promptTimeout>
        <core:hideOpenPrompt>false</core:hideOpenPrompt>
        <core:allowDatabasePromptLookup>false</core:allowDatabasePromptLookup>
        <core:messageBase>Pos/PaymentService/PaymentServiceMessages</core:messageBase>
        <core:messageId>GENERAL_ERROR</core:messageId>
        <core:messageText></core:messageText>
    </core:messageState>
    <core:messageState>
        <core:url></core:url>
        <core:stateID>UserNotAuthorised</core:stateID>
        <core:name></core:name>
        <core:className>com.enactor.coreUI.states.UIMessageState</core:className>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>223</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>260</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <handledEvents>
                <handledEvent name="OKPressed"/>
                <handledEvent name="CancelPressed"/>
            </handledEvents>
        </core:metaData>
        <core:typeId>enactor.types.MessageState</core:typeId>
        <core:singleInstance>false</core:singleInstance>
        <core:respondToViewEvents>false</core:respondToViewEvents>
        <core:actionInputMappings/>
        <core:actionOutputMappings/>
        <core:eventLink>
            <core:linkID>2</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>EndProcessCancel</core:toActionID>
            <core:condition></core:condition>
            <core:event>CancelPressed</core:event>
        </core:eventLink>
        <core:eventLink>
            <core:linkID>1</core:linkID>
            <core:toStateID>Start</core:toStateID>
            <core:toActionID></core:toActionID>
            <core:condition></core:condition>
            <core:event>OKPressed</core:event>
        </core:eventLink>
        <core:keepPromptOpen>false</core:keepPromptOpen>
        <core:keepPreviousPromptOpen>false</core:keepPreviousPromptOpen>
        <core:promptTimeout>0</core:promptTimeout>
        <core:hideOpenPrompt>false</core:hideOpenPrompt>
        <core:allowDatabasePromptLookup>false</core:allowDatabasePromptLookup>
        <core:messageBase>Pos/PaymentService/PaymentServiceMessages</core:messageBase>
        <core:messageId>USER_NOT_AUTHORISED</core:messageId>
        <core:messageText></core:messageText>
    </core:messageState>
    <core:state>
        <core:url></core:url>
        <core:stateID>Start</core:stateID>
        <core:name></core:name>
        <core:className></core:className>
        <core:defaultNextStateID></core:defaultNextStateID>
        <core:uiHints>
            <entry>
                <key>com.enactor.tools.editor.process.style</key>
                <value>1</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.xloc</key>
                <value>212</value>
            </entry>
            <entry>
                <key>com.enactor.tools.editor.process.yloc</key>
                <value>488</value>
            </entry>
        </core:uiHints>
        <core:metaData>
            <handledEvents>
                <handledEvent name="StateEntered"/>
            </handledEvents>
            <stateDataTypes>
                <stateDataType required="true" name="enactor.paymentService.CardDetailsFull">
                    <core:interfaceName>com.enactor.paymentService.ICardDetailsFull</core:interfaceName>
                </stateDataType>
            </stateDataTypes>
        </core:metaData>
        <core:typeId>enactor.types.BasicState</core:typeId>
        <core:singleInstance>false</core:singleInstance>
        <core:respondToViewEvents>false</core:respondToViewEvents>
        <core:actionInputMappings>
            <core:actionMapping>
                <core:actionID>Call PaymentServiceBalanceEnquiry</core:actionID>
                <core:mappings>
                    <core:processMappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.mfc.GiftCardDetails">
<core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType name="enactor.mfc.GiftCardDetails">
<core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.pos.IsKeyed">
<core:interfaceName>java.lang.Boolean</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType required="true" name="enactor.pos.IsKeyed">
<core:interfaceName>java.lang.Boolean</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.paymentService.CardInsertMessage">
<core:interfaceName>java.lang.String</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType required="true" name="enactor.paymentService.CardInsertMessage">
<core:interfaceName>java.lang.String</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.coreUI.User">
<core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType required="true" name="enactor.coreUI.User">
<core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.paymentService.KeyedCardAllowedPrivilegeId">
<core:interfaceName>java.lang.String</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType name="enactor.paymentService.KeyedCardAllowedPrivilegeId">
<core:interfaceName>java.lang.String</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.paymentService.KeyedCardAuthorisesPrivilegeId">
<core:interfaceName>java.lang.String</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType name="enactor.paymentService.KeyedCardAuthorisesPrivilegeId">
<core:interfaceName>java.lang.String</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.mfc.TransactionHandler">
<core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType required="true" name="enactor.mfc.TransactionHandler">
<core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                    </core:processMappings>
                    <core:stateMappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="enactor.coreUI.UserLocale">
<core:interfaceName>com.enactor.core.localisation.ILocale</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="enactor.mfc.BaseCurrency">
<core:interfaceName>com.enactor.mfc.currency.ICurrency</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="enactor.mfc.Device">
<core:interfaceName>com.enactor.mfc.device.IDevice</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="enactor.mfc.PosTerminal">
<core:interfaceName>com.enactor.mfc.posTerminal.IPOSTerminal</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="enactor.mfc.Location">
<core:interfaceName>com.enactor.mfc.location.ILocation</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="enactor.pos.CurrentlyInTrainingMode">
<core:interfaceName>java.lang.Boolean</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="PaymentService">
<core:interfaceName>com.enactor.paymentService.IPaymentService</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                    </core:stateMappings>
                </core:mappings>
            </core:actionMapping>
            <core:actionMapping>
                <core:actionID>CopyCardDetails</core:actionID>
                <core:mappings>
                    <core:processMappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.mfc.GiftCardDetails">
<core:interfaceName>com.enactor.mfc.basket.items.IGiftCardDetails</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType name="enactor.mfc.CardDetails">
<core:interfaceName>com.enactor.mfc.basket.items.ICardDetails</core:interfaceName>
                            </core:targetDataType>
                            <core:expression>giftCardDetails.cardDetails</core:expression>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType required="true" name="enactor.paymentService.BalanceEnquiryResponse">
<core:interfaceName>com.enactor.paymentService.IBalanceEnquiryResponse</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType name="enactor.paymentService.PaymentServiceResponse">
<core:interfaceName>com.enactor.paymentService.IPaymentServiceResponse</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.mfc.TransactionHandler">
<core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType required="true" name="enactor.mfc.TransactionHandler">
<core:interfaceName>com.enactor.mfc.retail.transaction.IRetailTransactionHandler</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.coreUI.User">
<core:interfaceName>com.enactor.core.signOn.ISignedOnUser</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType required="true" name="enactor.coreUI.UserLocale">
<core:interfaceName>com.enactor.core.localisation.ILocale</core:interfaceName>
                            </core:targetDataType>
                            <core:expression>user.locale</core:expression>
                        </core:mappings>
                    </core:processMappings>
                    <core:stateMappings>
                        <core:mappings>
                            <core:targetDataType required="true" name="enactor.mfc.BasketItem">
<core:interfaceName>com.enactor.mfc.basket.items.IBasketItem</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                    </core:stateMappings>
                </core:mappings>
            </core:actionMapping>
        </core:actionInputMappings>
        <core:actionOutputMappings>
            <core:actionMapping>
                <core:actionID>GiftCardBalanceResponse</core:actionID>
                <core:mappings>
                    <core:processMappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.coreUI.Entity">
<core:interfaceName>com.enactor.core.entities.IEntity</core:interfaceName>
                            </core:sourceDataType>
                            <core:targetDataType required="true" name="enactor.cardAuthorisation.messages.GiftCardBalanceResponse">
<core:interfaceName>com.enactor.cardAuthorisation.messages.giftCard.IGiftCardBalanceResponse</core:interfaceName>
                            </core:targetDataType>
                        </core:mappings>
                    </core:processMappings>
                    <core:stateMappings/>
                </core:mappings>
            </core:actionMapping>
            <core:actionMapping>
                <core:actionID>CopyCardDetails</core:actionID>
                <core:mappings>
                    <core:processMappings/>
                    <core:stateMappings>
                        <core:mappings>
                            <core:sourceDataType name="enactor.mfc.BasketItem">
<core:interfaceName>com.enactor.mfc.basket.items.IBasketItem</core:interfaceName>
                            </core:sourceDataType>
                        </core:mappings>
                    </core:stateMappings>
                </core:mappings>
            </core:actionMapping>
        </core:actionOutputMappings>
        <core:eventLink>
            <core:linkID>1</core:linkID>
            <core:toStateID></core:toStateID>
            <core:toActionID>CheckAllowed</core:toActionID>
            <core:condition></core:condition>
            <core:event>StateEntered</core:event>
        </core:eventLink>
    </core:state>
    <core:stateTransitions/>
</core:process>
