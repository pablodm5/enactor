<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<b:process targetNamespace="http://www.enactor.com/core" name="GenericActivityFlow" xmlns:action="http://www.enactor.com/coreui/InvokeActionService" xmlns:actionTypes="http://www.enactor.com/coreui/InvokeActionService/Types" xmlns:b="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:cb="http://www.enactor.com/core/bpel" xmlns:core="http://www.enactor.com/core" xmlns:coreui="http://www.enactor.com/coreui" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:mfc="http://www.enactor.com/mfc" xmlns:mjbp11="http://www.enactor.com/bpel/1_1/activity" xmlns:mjxpbp11="http://www.enactor.com/xpath/bpel/1_1" xmlns:ns1="http://java.basic/xsd" xmlns:ns10="tools" xmlns:ns11="http://maven.apache.org/POM/4.0.0" xmlns:ns16="http://www.w3.org/2005/08/addressing" xmlns:ns17="http://www.w3.org/2003/05/soap-envelope" xmlns:ns2="http://www.enactor.com/coreui/InvokeProcessService" xmlns:ns20="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns4="http://www.enactor.com/bpel/rt" xmlns:ns5="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:plnk="http://schemas.xmlsoap.org/ws/2003/05/partner-link/" xmlns:retail="http://www.enactor.com/retail" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:tools="http://www.enactor.com/tools" xmlns:wb="http://www.enactor.com/tools/bpel/wb/">
    <wb:vmodel>
        <wb:layoutMode>AUTO</wb:layoutMode>
        <wb:visualThemeID>built-in-default-theme</wb:visualThemeID>
        <wb:orientation>NONE</wb:orientation>
    </wb:vmodel>
    <core:notes>
        <core:note id="1">
            <wb:vinfo xywh="584,11,574,57"/>
            <cb:content xml:lang="en-GB">This outer repeat until loop runs various types of business activities until it comes to something it can't process itself. E.g. HumanTaskActivityType. In such cases, it completes this BPEL instance. </cb:content>
        </core:note>
        <core:note id="2">
            <wb:vinfo xywh="764,1268,135,79"/>
            <cb:content xml:lang="en-GB">This will reply and exit with error if lock not obtained</cb:content>
        </core:note>
    </core:notes>
    <b:documentation>
		This is the BPEL that drives all the Simple Activity Flow business processes.(Except for the old Customer Activity Flows)
	</b:documentation>
    <b:partnerLinks>
        <b:partnerLink initializePartnerRole="yes" myRole="GenericActivityFlowImpl" partnerLinkType="core:GenericActivityFlowPLT" name="client"/>
        <b:partnerLink initializePartnerRole="yes" partnerRole="GenericActivityFlowImpl" partnerLinkType="core:GenericActivityFlowPLT" name="genericActivityFlow"/>
        <b:partnerLink initializePartnerRole="yes" partnerRole="BusinessProcessUtilServiceImpl" partnerLinkType="core:BusinessProcessUtilServicePLT" name="businessProcessUtil"/>
        <b:partnerLink initializePartnerRole="yes" partnerRole="TaskManagerServiceImpl" partnerLinkType="core:TaskManagerPLT" name="taskManager"/>
        <b:partnerLink initializePartnerRole="yes" partnerRole="InvokeActionServiceImpl" partnerLinkType="action:InvokeActionServicePLT" name="invokeAction"/>
        <b:partnerLink initializePartnerRole="yes" partnerRole="InvokeProcessServiceImpl" partnerLinkType="ns2:InvokeProcessServicePLT" name="invokeApplicationProcess"/>
    </b:partnerLinks>
    <b:variables>
        <b:variable messageType="core:invokeRequestMessage" name="invokeRequest"/>
        <b:variable messageType="core:invokeResponseMessage" name="invokeResponse"/>
        <b:variable messageType="core:timeoutRequestMessage" name="timeoutRequest"/>
        <b:variable messageType="core:timeoutResponseMessage" name="timeoutResponse"/>
        <b:variable type="xsd:string" name="processId" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:string" name="lastActivityId" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:string" name="lastActivityOutcome" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:string" name="activityTypeName" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:string" name="instanceId" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable messageType="core:getNextActivityWithMatchTypeRequestMessage" name="getNextActivityRequest"/>
        <b:variable messageType="core:getNextActivityWithMatchTypeResponseMessage" name="getNextActivityResponse"/>
        <b:variable messageType="core:getActivityRequestMessage" name="getActivityRequest"/>
        <b:variable messageType="core:getActivityResponseMessage" name="getActivityResponse"/>
        <b:variable messageType="core:getActivityTypeRequestMessage" name="getActivityTypeRequest"/>
        <b:variable messageType="core:getActivityTypeResponseMessage" name="getActivityTypeResponse"/>
        <b:variable messageType="core:getActivityOutcomeRequestMessage" name="getActivityOutcomeRequest"/>
        <b:variable messageType="core:getActivityOutcomeResponseMessage" name="getActivityOutcomeResponse"/>
        <b:variable element="core:businessProcessData" name="businessProcessData"/>
        <b:variable element="core:activity" name="activity"/>
        <b:variable element="core:activityType" name="activityType"/>
        <b:variable element="core:activityOutcome" name="activityOutcome"/>
        <b:variable type="xsd:boolean" name="exit" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:boolean" name="isStart" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:boolean" name="replySent" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:boolean" name="isDiscarded" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:string" name="currentUser" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:boolean" name="isReRun" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable element="core:businessProcess" name="process"/>
        <b:variable type="xsd:string" name="lockRequester" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
        <b:variable type="xsd:boolean" name="taskInitiationFailed" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
    </b:variables>
    <b:pick createInstance="yes" name="Outer pick">
        <b:onMessage variable="invokeRequest" operation="invokeGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client">
            <b:sequence>
                <b:sequence name="Initialise">
                    <b:assign name="initialize input variables">
                        <b:copy>
                            <b:from part="parameters" variable="invokeRequest">
                                <b:query>core:businessProcessData</b:query>
							</b:from>
                            <b:to variable="businessProcessData"/>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:processId)</b:query>
							</b:from>
                            <b:to variable="processId"/>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:lastActivityId)</b:query>
							</b:from>
                            <b:to variable="lastActivityId">
                                <b:query/>
                        </b:to>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:lastActivityOutcome)
					</b:query>
							</b:from>
                            <b:to variable="lastActivityOutcome">
                                <b:query/>
                        </b:to>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:processInstanceId)</b:query>
                        </b:from>
                            <b:to variable="instanceId">
                                <b:query/>
                        </b:to>
                        </b:copy>
                        <b:copy>
                            <b:from>
                                <b:query>false()</b:query>
                        </b:from>
                            <b:to variable="businessProcessData">
                                <b:query>core:taskData/core:canPerformNextTask</b:query>
                        </b:to>
                        </b:copy>
                        <b:copy ignoreMissingFromData="yes">
                            <b:from>
                                <b:literal/>
                        </b:from>
                            <b:to variable="businessProcessData">
                                <b:query>core:taskData/core:nextTaskId</b:query>
                        </b:to>
                        </b:copy>
                        <b:copy>
                            <b:from>
                                <b:query>false()</b:query>
                        </b:from>
                            <b:to variable="replySent"/>
                        </b:copy>
                        <b:copy>
                            <b:from>
                                <b:query>false()</b:query>
                        </b:from>
                            <b:to variable="isDiscarded"/>
                        </b:copy>
                        <b:copy ignoreMissingFromData="yes">
                            <b:from part="parameters" variable="invokeRequest">
                                <b:query>core:currentUser</b:query>
                        </b:from>
                            <b:to variable="currentUser"/>
                        </b:copy>
                        <b:copy>
                            <b:from part="parameters" variable="invokeRequest">
                                <b:query>core:isReRun</b:query>
                        </b:from>
                            <b:to variable="isReRun"/>
                        </b:copy>
                        <b:copy>
                            <b:from>
                                <b:query>mjxpbp11:instantiateMessage('invokeResponse')</b:query>
                            </b:from>
                            <b:to variable="invokeResponse"/>
                        </b:copy>
                        <b:copy>
                            <b:from>
                                <b:query>mjxpbp11:generateGUID()</b:query>
                            </b:from>
                            <b:to variable="lockRequester"/>
                        </b:copy>
                        <b:copy>
                            <b:from>
                                <b:query>false()</b:query>
                        											</b:from>
                            <b:to variable="taskInitiationFailed">
        </b:to>
                        </b:copy>
                    </b:assign>
                    <b:scope name="Load Business Process">
                        <b:variables>
                            <b:variable messageType="core:loadProcessRequestMessage" name="loadProcessRequest"/>
                            <b:variable messageType="core:loadProcessResponseMessage" name="loadProcessResponse"/>
                        </b:variables>
                        <b:if name="If processId available">
                            <b:condition>not(mjxpbp11:empty($processId))</b:condition>
                            <b:sequence name="Load Business process">
                                <wb:vinfo xywh="0,0,170,440" orientation="VERTICAL"/>
                                <b:assign name="PrepareEvaluateParamsRequest">
                                    <b:copy>
                                        <b:from>mjxpbp11:instantiateMessage('loadProcessRequest')</b:from>
                                        <b:to variable="loadProcessRequest"/>
                                    </b:copy>
                                    <b:copy>
                                        <b:from variable="processId"/>
                                        <b:to variable="loadProcessRequest">
                                            <b:query>core:processId</b:query>
                                        </b:to>
                                    </b:copy>
                                </b:assign>
                                <b:invoke operation="loadProcess" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="loadProcessResponse" inputVariable="loadProcessRequest" name="LoadProcess"/>
                                <b:assign name="ExtractData">
                                    <b:copy>
                                        <b:from part="parameters" variable="loadProcessResponse">
                                            <b:query>core:businessProcess</b:query>
                                        </b:from>
                                        <b:to variable="process"/>
                                    </b:copy>
                                </b:assign>
                            </b:sequence>
                        </b:if>
                    </b:scope>
                </b:sequence>
                <b:repeatUntil name="Loop until a terminating activity type is found">
                    <wb:vinfo xywh="400,0,5438,3895" notes="1"/>
                    <b:sequence>
                        <b:sequence>
                            <b:if name="If Activity Completion">
                                <b:condition>not(mjxpbp11:empty(string($businessProcessData/core:lastActivityId))) and not(mjxpbp11:empty(string($businessProcessData/core:lastActivityReference)))</b:condition>
                                <b:scope>
                                    <b:variables>
                                        <b:variable type="xsd:boolean" name="lockObtained" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                        <b:variable type="xsd:boolean" name="suspend" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                    </b:variables>
                                    <b:sequence>
                                        <b:sequence name="Check for suspend outcome">
                                            <b:scope name="Check suspend outcome">
                                                <b:variables>
                                                    <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                    <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                </b:variables>
                                                <b:sequence name="CheckSuspendOutcomeAction">
                                                    <wb:vinfo xywh="0,0,210,861" orientation="VERTICAL"/>
                                                    <b:assign name="CreateInput">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                    </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns12="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:ns6="http://maven.apache.org/POM/4.0.0" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityOutcome"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcess"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcess&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessID"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData</b:query>
                                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>com.enactor.commonUI.actions.CheckBusinessProcessSuspendActivityOutcomeAction</b:literal>
                                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:actionClassName</b:query>
                                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="lastActivityOutcome"/>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.coreUI.business.process.BusinessProcessActivityOutcome</b:query>
                                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="processId"/>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.coreUI.business.process.BusinessProcessID</b:query>
                                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="lastActivityId"/>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
                                                                            </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                    <b:assign name="ExtractOutput">
                                                        <b:copy>
                                                            <b:from part="parameters" variable="actionOutputMessage">
                                                                <b:query>core:invokeActionOutput/core:output/enactor.coreUI.business.process.Suspend</b:query>
                                                                            </b:from>
                                                            <b:to variable="suspend">
                    </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:if name="If Suspend">
                                                        <b:condition>$suspend= 'true'</b:condition>
                                                        <b:sequence>
                                                            <wb:vinfo xywh="0,0,170,353" orientation="VERTICAL"/>
                                                            <b:assign name="Prepare response">
                                                                <b:copy>
                                                                    <b:from variable="businessProcessData">
                                                                        <b:query/>
                                </b:from>
                                                                    <b:to part="parameters" variable="invokeResponse">
                                                                        <b:query>core:businessProcessData</b:query>
                            	</b:to>
                                                                </b:copy>
                                                            </b:assign>
                                                            <b:reply variable="invokeResponse" operation="invokeGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client" name="Reply"/>
                                                            <b:exit/>
                                                        </b:sequence>
                                                    </b:if>
                                                </b:sequence>
                                            </b:scope>
                                        </b:sequence>
                                        <b:scope name="RequestLock">
                                            <wb:vinfo xywh="260,557,570,593" notes="2"/>
                                            <b:variables>
                                                <b:variable type="xsd:string" name="lockRequestOutcome" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                            </b:variables>
                                            <b:sequence name="AcquireBPExecutionLockAction">
                                                <b:assign name="ActCompletion-AcquireLock-CreateInput">
                                                    <b:copy>
                                                        <b:from>
                                                            <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                        </b:from>
                                                        <b:to part="parameters" variable="actionInputMessage"/>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from>
                                                            <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns12="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:ns5="http://maven.apache.org/POM/4.0.0" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.LockRequester"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                        </b:from>
                                                        <b:to part="parameters" variable="actionInputMessage">
                                                            <b:query>core:inputData</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from>
                                                            <b:literal>com.enactor.bpel.rt.business.process.actions.AcquireBPExecutionLockToCompleteActivityAction</b:literal>
                                                        </b:from>
                                                        <b:to part="parameters" variable="actionInputMessage">
                                                            <b:query>core:actionClassName</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from variable="instanceId"/>
                                                        <b:to part="parameters" variable="actionInputMessage">
                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from variable="businessProcessData">
                                                            <b:query>core:lastActivityReference</b:query>
                                                        </b:from>
                                                        <b:to part="parameters" variable="actionInputMessage">
                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from variable="lockRequester"/>
                                                        <b:to part="parameters" variable="actionInputMessage">
                                                            <b:query>core:inputData/enactor.core.business.process.LockRequester</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                </b:assign>
                                                <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="ActCompletion-AcquireBPExecutionLockAction"/>
                                                <b:if>
                                                    <b:condition>$actionOutputMessage.parameters/core:invokeActionOutput/core:outcome/@core:name = 'Success'</b:condition>
                                                    <b:assign name="Set Lock Acquired">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:query>true()</b:query>
                                                            </b:from>
                                                            <b:to variable="lockObtained"/>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:else>
                                                        <b:sequence>
                                                            <wb:vinfo xywh="0,0,170,367" orientation="VERTICAL"/>
                                                            <b:assign name="Prepare response">
                                                                <b:copy>
                                                                    <b:from variable="businessProcessData">
                                                                        <b:query/>
                                </b:from>
                                                                    <b:to part="parameters" variable="invokeResponse">
                                                                        <b:query>/core:businessProcessData</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy ignoreMissingFromData="yes">
                                                                    <b:from part="parameters" variable="lockRequestOutcome">
                                                                        <b:query>core:invokeActionOutput/core:outcome/@core:name</b:query>
                                                                    </b:from>
                                                                    <b:to part="parameters" variable="invokeResponse">
                                                                        <b:query>core:errorMessage</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy ignoreMissingFromData="yes">
                                                                    <b:from part="parameters" variable="lockRequestOutcome">
                                                                        <b:query>core:invokeActionOutput/core:output/enactor.core.ErrorDetails</b:query>
                                                                    </b:from>
                                                                    <b:to part="parameters" variable="invokeResponse">
                                                                        <b:query>core:errorDetails</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                            </b:assign>
                                                            <b:reply variable="invokeResponse" operation="invokeGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client" name="Reply"/>
                                                            <b:exit/>
                                                        </b:sequence>
                                                    </b:else>
                                                </b:if>
                                            </b:sequence>
                                        </b:scope>
                                        <b:if name="If Lock Obtained">
                                            <b:condition>$lockObtained</b:condition>
                                            <b:sequence name="Handle Activity Completion">
                                                <wb:vinfo xywh="0,0,731,1678" orientation="VERTICAL"/>
                                                <b:if name="If not discarded">
                                                    <b:condition>$isDiscarded = 'false'</b:condition>
                                                    <b:sequence name="If not discarded">
                                                        <wb:vinfo xywh="0,0,691,1376" orientation="VERTICAL"/>
                                                        <b:scope name="Handle Long Running Activity Completion">
                                                            <b:variables>
                                                                <b:variable messageType="core:getActivityImplementationTypeRequestMessage" name="getActivityImplTypeRequestMessage"/>
                                                                <b:variable messageType="core:getActivityImplementationTypeResponseMessage" name="getActivityImplTypeResponseMessage"/>
                                                                <b:variable type="xsd:integer" name="activityImplementationType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                            </b:variables>
                                                            <b:if name="If not reRun">
                                                                <b:condition>$isReRun = 'false'</b:condition>
                                                                <b:sequence name="Complete Long Runnning Activity">
                                                                    <b:sequence name="Get Activity Impl">
                                                                        <wb:vinfo xywh="0,60,170,454" orientation="VERTICAL"/>
                                                                        <b:assign name="Prepare Request" skipCloning="yes">
                                                                            <b:copy>
                                                                                <b:from>mjxpbp11:instantiateMessage('getActivityImplTypeRequestMessage')</b:from>
                                                                                <b:to variable="getActivityImplTypeRequestMessage">
                                        </b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from variable="process"/>
                                                                                <b:to part="parameters" variable="getActivityImplTypeRequestMessage">
                                                                                    <b:query>core:process</b:query>
                                                    </b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from variable="lastActivityId"/>
                                                                                <b:to part="parameters" variable="getActivityImplTypeRequestMessage">
                                                                                    <b:query>core:activityId</b:query>
                                                    </b:to>
                                                                            </b:copy>
                                                                        </b:assign>
                                                                        <b:invoke operation="getActivityImplementationType" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="getActivityImplTypeResponseMessage" inputVariable="getActivityImplTypeRequestMessage" name="Get Activity Impl Type"/>
                                                                        <b:assign name="ExtractData">
                                                                            <b:copy>
                                                                                <b:from part="parameters" variable="getActivityImplTypeResponseMessage">
                                                                                    <b:query>core:activityImplementationType</b:query>
                                                    </b:from>
                                                                                <b:to variable="activityImplementationType">
                                        </b:to>
                                                                            </b:copy>
                                                                        </b:assign>
                                                                    </b:sequence>
                                                                    <b:if name="Complete Human Task">
                                                                        <b:condition>$activityImplementationType = 3 and $lastActivityOutcome != 'Timeout' and $taskInitiationFailed = 'false'</b:condition>
                                                                        <b:scope name="Complete Human Task">
                                                                            <b:variables>
                                                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                                                <b:variable type="xsd:string" name="completeTaskOutcome" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                                            </b:variables>
                                                                            <b:sequence name="Complete Human Task">
                                                                                <wb:vinfo xywh="0,0,170,514" orientation="VERTICAL"/>
                                                                                <b:assign name="CreateInput">
                                                                                    <b:copy>
                                                                                        <b:from>
                                                                                            <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from>
                                                                                            <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns12="tools" xmlns:ns13="http://www.enactor.com/tools/bpel/wb/" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:ns4="http://maven.apache.org/POM/4.0.0" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="CompletingUserId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="TaskOutcome"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="TaskId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="TaskOutput"&gt;
            &lt;core:interfaceName&gt;java.lang.Object&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                            </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData</b:query>
                                                            </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from>
                                                                                            <b:literal>com.enactor.task.action.AdvancedCompleteTaskAction</b:literal>
                                                            </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:actionClassName</b:query>
                                                            </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from variable="businessProcessData">
                                                                                            <b:query>core:lastActivityReference</b:query>
                                                            </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData/TaskId</b:query>
                                                            </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from variable="businessProcessData"/>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData/TaskOutput</b:query>
                                                            </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from variable="currentUser"/>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData/CompletingUserId</b:query>
                                                            </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy ignoreMissingFromData="yes">
                                                                                        <b:from variable="businessProcessData">
                                                                                            <b:query>core:lastActivityOutcome</b:query>
                                                            </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData/TaskOutcome</b:query>
                                                            </b:to>
                                                                                    </b:copy>
                                                                                </b:assign>
                                                                                <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                                                <b:assign name="ExtractInput">
                                                                                    <b:copy>
                                                                                        <b:from part="parameters" variable="actionOutputMessage">
                                                                                            <b:query>core:invokeActionOutput/core:outcome/core:name</b:query>
                                                            </b:from>
                                                                                        <b:to variable="completeTaskOutcome">
                                                </b:to>
                                                                                    </b:copy>
                                                                                </b:assign>
                                                                                <b:if name="Completion Failed ?">
                                                                                    <wb:vinfo xywh="0,424,150,50" minimized="true"/>
                                                                                    <b:condition>$completeTaskOutcome != 'Success'</b:condition>
                                                                                    <b:sequence>
                                                                                        <wb:vinfo xywh="0,0,170,367" orientation="VERTICAL"/>
                                                                                        <b:assign name="Prepare response">
                                                                                            <b:copy>
                                                                                                <b:from variable="businessProcessData">
                                                                                                    <b:query/>
                                </b:from>
                                                                                                <b:to part="parameters" variable="invokeResponse">
                                                                                                    <b:query>core:businessProcessData</b:query>
                            	</b:to>
                                                                                            </b:copy>
                                                                                            <b:copy ignoreMissingFromData="yes">
                                                                                                <b:from part="parameters" variable="actionOutputMessage">
                                                                                                    <b:query>core:invokeActionOutput/core:output/ErrorMessage</b:query>
                                                                    </b:from>
                                                                                                <b:to part="parameters" variable="invokeResponse">
                                                                                                    <b:query>core:errorMessage</b:query>
                                                                    </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy ignoreMissingFromData="yes">
                                                                                                <b:from part="parameters" variable="actionOutputMessage">
                                                                                                    <b:query>core:invokeActionOutput/core:output/enactor.core.ErrorDetails</b:query>
                                                                    </b:from>
                                                                                                <b:to part="parameters" variable="invokeResponse">
                                                                                                    <b:query>core:errorDetails</b:query>
                                                                    </b:to>
                                                                                            </b:copy>
                                                                                        </b:assign>
                                                                                        <b:reply variable="invokeResponse" operation="invokeGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client" name="Reply"/>
                                                                                        <b:exit/>
                                                                                    </b:sequence>
                                                                                </b:if>
                                                                            </b:sequence>
                                                                        </b:scope>
                                                                    </b:if>
                                                                    <b:if name="Long Running Task Completed?">
                                                                        <b:condition>($activityImplementationType = 3 or $activityImplementationType = 4 or $activityImplementationType = 11) and $lastActivityOutcome != 'Timeout'</b:condition>
                                                                        <b:scope name="Uninstall Deadlines">
                                                                            <b:variables>
                                                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                                            </b:variables>
                                                                            <b:sequence name="UpdateDeadlines">
                                                                                <wb:vinfo xywh="0,0,170,335" orientation="VERTICAL"/>
                                                                                <b:assign name="ActCompletion-UpdateDeadlines-CreateInput">
                                                                                    <b:copy>
                                                                                        <b:from>
                                                                                            <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                                                        </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage"/>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from>
                                                                                            <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns12="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:ns5="http://maven.apache.org/POM/4.0.0" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="enactor.core.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                                                        </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData</b:query>
                                                                                        </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from>
                                                                                            <b:literal>com.enactor.bpel.rt.business.process.actions.ProcessBPActivityCompletedAction</b:literal>
                                                                                        </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:actionClassName</b:query>
                                                                                        </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from variable="instanceId"/>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                                                        </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from variable="businessProcessData">
                                                                                            <b:query>core:lastActivityId</b:query>
                                                                                        </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                                                        </b:to>
                                                                                    </b:copy>
                                                                                    <b:copy>
                                                                                        <b:from variable="businessProcessData">
                                                                                            <b:query>core:lastActivityReference</b:query>
                                                                                        </b:from>
                                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                                                        </b:to>
                                                                                    </b:copy>
                                                                                </b:assign>
                                                                                <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeUpdateDeadlinesAction"/>
                                                                            </b:sequence>
                                                                        </b:scope>
                                                                    </b:if>
                                                                </b:sequence>
                                                            </b:if>
                                                        </b:scope>
                                                        <b:scope name="Handle Activity Completion">
                                                            <b:variables>
                                                                <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                                <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                                <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                                <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                                                <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                            </b:variables>
                                                            <b:sequence name="Handle Activity Completion">
                                                                <b:scope name="Get Next Activity">
                                                                    <b:variables>
                                                                        <b:variable type="xsd:string" name="matchType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                                    </b:variables>
                                                                    <b:sequence name="Get Next Activity">
                                                                        <wb:vinfo xywh="0,0,190,572" orientation="VERTICAL"/>
                                                                        <b:assign name="Prepare get next activity request" skipCloning="yes">
                                                                            <b:copy>
                                                                                <b:from>mjxpbp11:instantiateMessage('getNextActivityRequest')
								</b:from>
                                                                                <b:to variable="getNextActivityRequest">
                    </b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from variable="process"/>
                                                                                <b:to part="parameters" variable="getNextActivityRequest">
                                                                                    <b:query>core:process</b:query>
											</b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from variable="lastActivityId"/>
                                                                                <b:to part="parameters" variable="getNextActivityRequest">
                                                                                    <b:query>core:lastActivityId</b:query>
											</b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from variable="lastActivityOutcome"/>
                                                                                <b:to part="parameters" variable="getNextActivityRequest">
                                                                                    <b:query>core:lastActivityOutcome</b:query>
											</b:to>
                                                                            </b:copy>
                                                                        </b:assign>
                                                                        <b:invoke operation="getNextActivityWithMatchType" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="getNextActivityResponse" inputVariable="getNextActivityRequest" name="Get Next Activity"/>
                                                                        <b:assign name="Extract the activity">
                                                                            <b:copy ignoreMissingFromData="yes">
                                                                                <b:from part="parameters" variable="getNextActivityResponse">
                                                                                    <b:query>core:getNextActivityResult/core:nextActivity</b:query>
                                                        </b:from>
                                                                                <b:to variable="activity">
                    </b:to>
                                                                            </b:copy>
                                                                            <b:copy ignoreMissingFromData="yes">
                                                                                <b:from part="parameters" variable="getNextActivityResponse">
                                                                                    <b:query>string(core:getNextActivityResult/core:matchType)</b:query>
                                                            </b:from>
                                                                                <b:to variable="matchType">
                    </b:to>
                                                                            </b:copy>
                                                                        </b:assign>
                                                                        <b:if name="If not reRun">
                                                                            <b:condition>$isReRun = 'false'</b:condition>
                                                                            <b:if name="If 'CatchAll' match type">
                                                                                <wb:vinfo xywh="0,0,150,50" minimized="true"/>
                                                                                <b:condition>not(mjxpbp11:empty($matchType)) and ($matchType = 'PROCESS_CATCH_ALL' or $matchType = 'ACTIVITY_CATCH_ALL')</b:condition>
                                                                                <b:scope name="Log Unexpected Outcome Error">
                                                                                    <b:variables>
                                                                                        <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                                        <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                                                    </b:variables>
                                                                                    <b:sequence name="Log Unexpected Outcome Error">
                                                                                        <b:assign name="CreateInput">
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns11="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://maven.apache.org/POM/4.0.0" xmlns:ns15="http://www.enactor.com/core/bpel" xmlns:retail="http://www.enactor.com/retail" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.LogEntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.Integer&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ProcessId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.EntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ReferenceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.Message"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:literal>com.enactor.commonUI.actions.WriteBPActivityEventToAppProcessLogAction</b:literal>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:actionClassName</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from variable="instanceId"/>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.coreUI.ReferenceId</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from variable="instanceId"/>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from variable="businessProcessData">
                                                                                                    <b:query>core:lastActivityId</b:query>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy ignoreMissingFromData="yes">
                                                                                                <b:from variable="businessProcessData">
                                                                                                    <b:query>core:lastActivityReference</b:query>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:query>number(0)</b:query>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.commonUI.logging.LogEntryType</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:literal>Generic Activity Flow BPEL</b:literal>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.coreUI.ProcessId</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:literal>businessProcess</b:literal>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.commonUI.logging.EntryType</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:query>concat('Unexpected Outcome Error. The activity : ',$businessProcessData/core:lastActivityId,' returned an unrecognised outcome :',$businessProcessData/core:lastActivityOutcome,'.')</b:query>
                                                            </b:from>
                                                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                                                    <b:query>core:inputData/enactor.coreUI.Message</b:query>
                                                            </b:to>
                                                                                            </b:copy>
                                                                                        </b:assign>
                                                                                        <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                                                        <b:assign name="eventType='ACTIVITY_END_ERROR'">
                                                                                            <b:copy>
                                                                                                <b:from>
                                                                                                    <b:literal>ACTIVITY_END_ERROR</b:literal>
													</b:from>
                                                                                                <b:to variable="eventType">
                                        </b:to>
                                                                                            </b:copy>
                                                                                        </b:assign>
                                                                                        <b:if name="If no Error Details">
                                                                                            <b:condition>mjxpbp11:empty($businessProcessData/core:processData/core:dataItem/core:type[@name='enactor.core.ErrorDetails']/../core:data)</b:condition>
                                                                                            <b:scope name="Add Unexpected Outcome Error Details">
                                                                                                <b:variables>
                                                                                                    <b:variable element="core:ErrorDetails" name="errorDetails"/>
                                                                                                </b:variables>
                                                                                                <b:sequence name="Add Unexpected Outcome Error Details">
                                                                                                    <b:assign name="Create Error Details">
                                                                                                        <b:copy>
                                                                                                            <b:from>
                                                                                                                <b:query>mjxpbp11:loadFromXMLFile('UnexpectedActivityOutcomeErrorDetails.xml')</b:query>
                                                                                                        </b:from>
                                                                                                            <b:to variable="errorDetails"/>
                                                                                                        </b:copy>
                                                                                                        <b:copy ignoreMissingFromData="yes">
                                                                                                            <b:from variable="businessProcessData">
                                                                                                                <b:query>core:lastActivityId</b:query>
                                                                                                        </b:from>
                                                                                                            <b:to variable="errorDetails">
                                                                                                                <b:query>core:applicationProcessData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                                                                        </b:to>
                                                                                                        </b:copy>
                                                                                                        <b:copy ignoreMissingFromData="yes">
                                                                                                            <b:from variable="businessProcessData">
                                                                                                                <b:query>core:lastActivityOutcome</b:query>
                                                                                                        </b:from>
                                                                                                            <b:to variable="errorDetails">
                                                                                                                <b:query>core:applicationProcessData/enactor.core.business.process.BusinessProcessActivityOutcome</b:query>
                                                                                                        </b:to>
                                                                                                        </b:copy>
                                                                                                        <b:copy>
                                                                                                            <b:from variable="errorDetails"/>
                                                                                                            <b:to variable="businessProcessData">
                                                                                                                <b:query>core:processData/enactor.core.ErrorDetails</b:query>
                                                                                                        </b:to>
                                                                                                        </b:copy>
                                                                                                    </b:assign>
                                                                                                </b:sequence>
                                                                                            </b:scope>
                                                                                        </b:if>
                                                                                    </b:sequence>
                                                                                </b:scope>
                                                                                <b:else>
                                                                                    <b:assign name="eventType='ACTIVITY_END'">
                                                                                        <b:copy>
                                                                                            <b:from>
                                                                                                <b:literal>ACTIVITY_END</b:literal>
													</b:from>
                                                                                            <b:to variable="eventType">
                                        </b:to>
                                                                                        </b:copy>
                                                                                    </b:assign>
                                                                                </b:else>
                                                                            </b:if>
                                                                        </b:if>
                                                                    </b:sequence>
                                                                </b:scope>
                                                                <b:if name="If not reRun">
                                                                    <b:condition>$isReRun = 'false'</b:condition>
                                                                    <b:sequence name="Record Activity End">
                                                                        <wb:vinfo xywh="0,0,172,487" orientation="VERTICAL"/>
                                                                        <b:assign name="Prepare action input" skipCloning="yes">
                                                                            <b:copy>
                                                                                <b:from>
                                                                                    <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;
                                                    	</b:literal>
                                                    </b:from>
                                                                                <b:to part="parameters" variable="actionInput">
                                    </b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from>
                                                                                    <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcess"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcess&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
														</b:literal>
                                                	</b:from>
                                                                                <b:to variable="invokeActionInput">
                                    </b:to>
                                                                            </b:copy>
                                                                            <b:copy ignoreMissingFromData="yes">
                                                                                <b:from variable="businessProcessData"/>
                                                                                <b:to variable="invokeActionInput">
                                                                                    <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                	</b:to>
                                                                            </b:copy>
                                                                            <b:copy ignoreMissingFromData="yes">
                                                                                <b:from variable="process"/>
                                                                                <b:to variable="invokeActionInput">
                                                                                    <b:query>enactor.core.business.process.BusinessProcess</b:query>
                                                	</b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from variable="eventType"/>
                                                                                <b:to variable="invokeActionInput">
                                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
                                                	</b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from>
                                                                                    <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
									</b:literal>
											</b:from>
                                                                                <b:to part="parameters" variable="actionInput">
                                                                                    <b:query>core:actionClassName</b:query>
											</b:to>
                                                                            </b:copy>
                                                                            <b:copy>
                                                                                <b:from variable="invokeActionInput"/>
                                                                                <b:to part="parameters" variable="actionInput">
                                                                                    <b:query>core:inputData</b:query>
											</b:to>
                                                                            </b:copy>
                                                                        </b:assign>
                                                                        <b:extensionActivity name="Open session">
                                                                            <core:openDataAccessSession supressJoinFailure="no"/>
                                                                        </b:extensionActivity>
                                                                        <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                                                        <b:extensionActivity name="Close session">
                                                                            <core:closeDataAccessSession supressJoinFailure="no"/>
                                                                        </b:extensionActivity>
                                                                    </b:sequence>
                                                                </b:if>
                                                            </b:sequence>
                                                        </b:scope>
                                                    </b:sequence>
                                                </b:if>
                                                <b:scope name="ReleaseLock">
                                                    <b:variables>
                                                        <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                        <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                    </b:variables>
                                                    <b:sequence name="ReleaseBPExecutionLockAction">
                                                        <b:assign name="ActCompletion-ReleaseLock-CreateInput">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                        </b:from>
                                                                <b:to part="parameters" variable="actionInputMessage"/>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns12="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:ns5="http://maven.apache.org/POM/4.0.0" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.LockRequester"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                        </b:from>
                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                    <b:query>core:inputData</b:query>
                                                        </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>com.enactor.bpel.rt.business.process.actions.ReleaseBPExecutionLockAction</b:literal>
                                                        </b:from>
                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                    <b:query>core:actionClassName</b:query>
                                                        </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="instanceId"/>
                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                    <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                        </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="businessProcessData">
                                                                    <b:query>core:lastActivityReference</b:query>
                                                                </b:from>
                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                    <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                        </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="lockRequester"/>
                                                                <b:to part="parameters" variable="actionInputMessage">
                                                                    <b:query>core:inputData/enactor.core.business.process.LockRequester</b:query>
                                                        </b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="ActCompletion-ReleaseBPExecutionLockAction"/>
                                                    </b:sequence>
                                                </b:scope>
                                            </b:sequence>
                                        </b:if>
                                    </b:sequence>
                                </b:scope>
                            </b:if>
                            <b:if name="If Process Start">
                                <b:condition>mjxpbp11:empty(string($businessProcessData/core:lastActivityId))</b:condition>
                                <b:sequence name="Process Start">
                                    <b:scope name="Record Process Start">
                                        <b:variables>
                                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                            <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                            <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                            <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                            <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                            <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                        </b:variables>
                                        <b:sequence name="Record Process Start">
                                            <wb:vinfo xywh="0,0,237,770" orientation="VERTICAL"/>
                                            <b:if name="Generate Instance ID if not rerun">
                                                <b:condition>$isReRun = 'false'</b:condition>
                                                <b:assign name="Generate and assign instance Id">
                                                    <b:copy>
                                                        <b:from>
                                                            <b:query>mjxpbp11:generateGUID()</b:query>
                                                        </b:from>
                                                        <b:to variable="businessProcessData">
                                                            <b:query>core:processInstanceId</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                </b:assign>
                                            </b:if>
                                            <b:assign name="eventType='PROCESS_START'">
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>PROCESS_START</b:literal>
												</b:from>
                                                    <b:to variable="eventType">
                            </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:query>true()</b:query>
                                                            </b:from>
                                                    <b:to variable="isStart">
                            </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="businessProcessData">
                                                        <b:query>string(core:processInstanceId)</b:query>
                                                            </b:from>
                                                    <b:to variable="instanceId">
                            </b:to>
                                                </b:copy>
                                            </b:assign>
                                            <b:assign name="Prepare action input" skipCloning="yes">
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;
                                                    	</b:literal>
                                                    </b:from>
                                                    <b:to part="parameters" variable="actionInput">
                        </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcess"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcess&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
														</b:literal>
                                                	</b:from>
                                                    <b:to variable="invokeActionInput">
                        </b:to>
                                                </b:copy>
                                                <b:copy ignoreMissingFromData="yes">
                                                    <b:from variable="businessProcessData"/>
                                                    <b:to variable="invokeActionInput">
                                                        <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                	</b:to>
                                                </b:copy>
                                                <b:copy ignoreMissingFromData="yes">
                                                    <b:from variable="process"/>
                                                    <b:to variable="invokeActionInput">
                                                        <b:query>enactor.core.business.process.BusinessProcess</b:query>
                                                	</b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="eventType"/>
                                                    <b:to variable="invokeActionInput">
                                                        <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
                                                	</b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
									</b:literal>
											</b:from>
                                                    <b:to part="parameters" variable="actionInput">
                                                        <b:query>core:actionClassName</b:query>
											</b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="invokeActionInput"/>
                                                    <b:to part="parameters" variable="actionInput">
                                                        <b:query>core:inputData</b:query>
											</b:to>
                                                </b:copy>
                                            </b:assign>
                                            <b:extensionActivity name="Open session">
                                                <core:openDataAccessSession supressJoinFailure="no"/>
                                            </b:extensionActivity>
                                            <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                            <b:extensionActivity name="Close session">
                                                <core:closeDataAccessSession supressJoinFailure="no"/>
                                            </b:extensionActivity>
                                        </b:sequence>
                                    </b:scope>
                                    <b:if name="If notEmpty(startingActivity)">
                                        <b:condition>not(mjxpbp11:empty($invokeRequest.parameters/core:startingActivity))</b:condition>
                                        <b:sequence name="GetStartingActivity">
                                            <b:assign name="Prepare get starting activity request" skipCloning="yes">
                                                <b:copy>
                                                    <b:from>mjxpbp11:instantiateMessage('getActivityRequest')</b:from>
                                                    <b:to variable="getActivityRequest">
                </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="process"/>
                                                    <b:to part="parameters" variable="getActivityRequest">
                                                        <b:query>core:process</b:query>
											</b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from part="parameters" variable="invokeRequest">
                                                        <b:query>core:startingActivity</b:query>
                                                    </b:from>
                                                    <b:to part="parameters" variable="getActivityRequest">
                                                        <b:query>core:activityId</b:query>
											</b:to>
                                                </b:copy>
                                            </b:assign>
                                            <b:invoke operation="getActivity" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="getActivityResponse" inputVariable="getActivityRequest" name="Get Starting Activity"/>
                                            <b:assign name="Extract the activity">
                                                <b:copy ignoreMissingFromData="yes">
                                                    <b:from part="parameters" variable="getActivityResponse">
                                                        <b:query>core:activity</b:query>
											</b:from>
                                                    <b:to variable="activity">
                </b:to>
                                                </b:copy>
                                            </b:assign>
                                        </b:sequence>
                                        <b:else>
                                            <b:sequence name="Get Default Start Activity">
                                                <b:assign name="Prepare Get Default Start Input" skipCloning="yes">
                                                    <b:copy>
                                                        <b:from>mjxpbp11:instantiateMessage('getNextActivityRequest')</b:from>
                                                        <b:to variable="getNextActivityRequest">
                    </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from variable="process"/>
                                                        <b:to part="parameters" variable="getNextActivityRequest">
                                                            <b:query>core:process</b:query>
											</b:to>
                                                    </b:copy>
                                                </b:assign>
                                                <b:invoke operation="getNextActivityWithMatchType" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="getNextActivityResponse" inputVariable="getNextActivityRequest" name="Get Default Start Activity"/>
                                                <b:assign name="Extract Default Start Activity">
                                                    <b:copy ignoreMissingFromData="yes">
                                                        <b:from part="parameters" variable="getNextActivityResponse">
                                                            <b:query>core:getNextActivityResult/core:nextActivity</b:query>
                                                        </b:from>
                                                        <b:to variable="activity">
                    </b:to>
                                                    </b:copy>
                                                </b:assign>
                                            </b:sequence>
                                        </b:else>
                                    </b:if>
                                </b:sequence>
                            </b:if>
                            <b:if name="Missing LastActivityReference">
                                <b:condition>not(mjxpbp11:empty(string($businessProcessData/core:lastActivityId))) and mjxpbp11:empty(string($businessProcessData/core:lastActivityReference))</b:condition>
                            </b:if>
                        </b:sequence>
                        <b:sequence name="Prepare for next task">
                            <wb:vinfo xywh="2688,1500,550,834" orientation="VERTICAL"/>
                            <b:if name="Clear the ReRun flag">
                                <wb:vinfo xywh="190,0,150,50" minimized="true"/>
                                <b:condition>$isReRun = 'true'</b:condition>
                                <b:assign name="Clear the ReRun flag">
                                    <b:copy>
                                        <b:from>
                                            <b:query>false()</b:query>
                                        </b:from>
                                        <b:to variable="isReRun"/>
                                    </b:copy>
                                </b:assign>
                            </b:if>
                            <b:scope name="Get next activity details">
                                <b:sequence>
                                    <wb:vinfo xywh="0,0,170,150" orientation="VERTICAL"/>
                                    <b:if name="GetActivityType">
                                        <wb:vinfo xywh="0,0,150,50" minimized="true"/>
                                        <b:condition>not(mjxpbp11:empty($activity))</b:condition>
                                        <b:sequence>
                                            <wb:vinfo xywh="0,0,170,440" orientation="VERTICAL"/>
                                            <b:assign name="Prepare get activity type request">
                                                <b:copy>
                                                    <b:from>mjxpbp11:instantiateMessage('getActivityTypeRequest')
										</b:from>
                                                    <b:to variable="getActivityTypeRequest"/>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="activity">
                                                        <b:query>core:activityType/core:activityTypeId</b:query>
													</b:from>
                                                    <b:to part="parameters" variable="getActivityTypeRequest">
                                                        <b:query>core:activityTypeId</b:query>
													</b:to>
                                                </b:copy>
                                            </b:assign>
                                            <b:invoke operation="getActivityType" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="getActivityTypeResponse" inputVariable="getActivityTypeRequest" name="Get Next Activity Type"/>
                                            <b:assign name="Extract the activity type">
                                                <b:copy>
                                                    <b:from part="parameters" variable="getActivityTypeResponse">
                                                        <b:query>core:activityType</b:query>
													</b:from>
                                                    <b:to variable="activityType"/>
                                                </b:copy>
                                            </b:assign>
                                        </b:sequence>
                                    </b:if>
                                    <b:if name="GetLastActivityOutcome">
                                        <wb:vinfo xywh="0,60,150,50" orientation="VERTICAL" minimized="true"/>
                                        <b:condition>not(mjxpbp11:empty($activity)) and not(mjxpbp11:empty($lastActivityOutcome))</b:condition>
                                        <b:sequence>
                                            <wb:vinfo xywh="0,0,245,554" orientation="VERTICAL"/>
                                            <b:sequence name="GetLastOutcomeObject">
                                                <wb:vinfo xywh="37,0,150,50" orientation="VERTICAL" minimized="true"/>
                                                <b:assign name="PrepareRequest" skipCloning="yes">
                                                    <b:copy>
                                                        <b:from>mjxpbp11:instantiateMessage('getActivityOutcomeRequest')</b:from>
                                                        <b:to part="parameters" variable="getActivityOutcomeRequest">
                                                            <b:query/>
                                                        </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from variable="lastActivityId">
                                                            <b:query/>
                                                        </b:from>
                                                        <b:to part="parameters" variable="getActivityOutcomeRequest">
                                                            <b:query>core:activityId</b:query>
                                                </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from variable="lastActivityOutcome">
                                                            <b:query/>
                                                        </b:from>
                                                        <b:to part="parameters" variable="getActivityOutcomeRequest">
                                                            <b:query>core:outcomeName</b:query>
                                                </b:to>
                                                    </b:copy>
                                                    <b:copy>
                                                        <b:from variable="process">
                                                            <b:query/>
                                                        </b:from>
                                                        <b:to part="parameters" variable="getActivityOutcomeRequest">
                                                            <b:query>core:process</b:query>
                                                </b:to>
                                                    </b:copy>
                                                </b:assign>
                                                <b:invoke operation="getActivityOutcome" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="getActivityOutcomeResponse" inputVariable="getActivityOutcomeRequest" name="GetLastActivityOutcome"/>
                                                <b:assign name="ExtractActivityOutcome">
                                                    <b:copy>
                                                        <b:from part="parameters" variable="getActivityOutcomeResponse">
                                                            <b:query>core:activityOutcome</b:query>
                                                        </b:from>
                                                        <b:to variable="activityOutcome">
                                                            <b:query/>
                                                        </b:to>
                                                    </b:copy>
                                                </b:assign>
                                            </b:sequence>
                                            <b:if name="ReplyBeforeProceedingIfNeeded">
                                                <wb:vinfo xywh="0,60,225,454" orientation="VERTICAL"/>
                                                <b:condition>$replySent = 'false' and $activityOutcome/core:proceedImmediately = 'false'</b:condition>
                                                <b:scope name="ReplyBeforeProceeding">
                                                    <wb:vinfo xywh="0,0,190,414" orientation="VERTICAL"/>
                                                    <b:sequence name="Reply">
                                                        <wb:vinfo xywh="0,0,170,374" orientation="VERTICAL"/>
                                                        <b:assign name="Prepare response">
                                                            <b:copy>
                                                                <b:from variable="businessProcessData">
                                                                    <b:query/>
                                                                </b:from>
                                                                <b:to part="parameters" variable="invokeResponse">
                                                                    <b:query>core:businessProcessData</b:query>
                            	</b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:reply variable="invokeResponse" operation="invokeGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client" name="Reply"/>
                                                        <b:assign name="MarkReplySent">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:query>true()</b:query>
                                                                </b:from>
                                                                <b:to variable="replySent"/>
                                                            </b:copy>
                                                        </b:assign>
                                                    </b:sequence>
                                                </b:scope>
                                            </b:if>
                                        </b:sequence>
                                    </b:if>
                                </b:sequence>
                            </b:scope>
                            <b:if name="Configure Admin Evaluator">
                                <b:condition>not(mjxpbp11:empty($activity))</b:condition>
                                <b:scope name="Configure Admin Evaluator">
                                    <b:variables>
                                        <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                        <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                    </b:variables>
                                    <b:sequence>
                                        <b:sequence name="ConfigureBusinessAdminEvaluatorAction">
                                            <b:assign name="CreateInput" skipCloning="yes">
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                </b:from>
                                                    <b:to part="parameters" variable="actionInputMessage"/>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns11="http://maven.apache.org/POM/4.0.0" xmlns:ns12="tools" xmlns:ns13="http://www.enactor.com/tools/bpel/wb/" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcess"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcess&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                </b:from>
                                                    <b:to part="parameters" variable="actionInputMessage">
                                                        <b:query>core:inputData</b:query>
                                                </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>com.enactor.bpel.rt.business.process.ConfigureBusinessAdminEvaluatorAction</b:literal>
                                                </b:from>
                                                    <b:to part="parameters" variable="actionInputMessage">
                                                        <b:query>core:actionClassName</b:query>
                                                </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="businessProcessData"/>
                                                    <b:to part="parameters" variable="actionInputMessage">
                                                        <b:query>core:inputData/enactor.core.business.process.BusinessProcessData</b:query>
                                                </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="process"/>
                                                    <b:to part="parameters" variable="actionInputMessage">
                                                        <b:query>core:inputData/enactor.core.business.process.BusinessProcess</b:query>
                                                </b:to>
                                                </b:copy>
                                            </b:assign>
                                            <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                        </b:sequence>
                                    </b:sequence>
                                </b:scope>
                            </b:if>
                            <b:scope name="EvaluateAndSetParams">
                                <b:variables>
                                    <b:variable messageType="core:evaluateAndSetParametersRequestMessage" name="evaluateParamsRequest"/>
                                    <b:variable messageType="core:evaluateAndSetParametersResponseMessage" name="evaluateParamsResponse"/>
                                </b:variables>
                                <b:if name="IfParamDefsExist">
                                    <b:condition>not(mjxpbp11:empty($activity)) and (not(mjxpbp11:empty($activity/core:parameters)) or $activityType/core:implementationType='3' or $activityType/core:implementationType='10')</b:condition>
                                    <b:sequence name="EvaluateAndSetParams">
                                        <b:assign name="PrepareEvaluateParamsRequest">
                                            <b:copy>
                                                <b:from>mjxpbp11:instantiateMessage('evaluateParamsRequest')</b:from>
                                                <b:to variable="evaluateParamsRequest">
                    </b:to>
                                            </b:copy>
                                            <b:copy>
                                                <b:from variable="activity"/>
                                                <b:to part="parameters" variable="evaluateParamsRequest">
                                                    <b:query>core:activity</b:query>
                                                    </b:to>
                                            </b:copy>
                                            <b:copy>
                                                <b:from variable="businessProcessData"/>
                                                <b:to part="parameters" variable="evaluateParamsRequest">
                                                    <b:query>core:businessProcessData</b:query>
                                                    </b:to>
                                            </b:copy>
                                        </b:assign>
                                        <b:invoke operation="evaluateAndSetParameters" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="evaluateParamsResponse" inputVariable="evaluateParamsRequest" name="EvaluateParams"/>
                                        <b:assign name="ExtractData">
                                            <b:copy>
                                                <b:from part="parameters" variable="evaluateParamsResponse">
                                                    <b:query>core:businessProcessData</b:query>
                                                    </b:from>
                                                <b:to variable="businessProcessData">
                    </b:to>
                                            </b:copy>
                                        </b:assign>
                                    </b:sequence>
                                </b:if>
                            </b:scope>
                        </b:sequence>
                        <b:if name="Guard">
                            <b:condition>not(mjxpbp11:empty($activity)) and not(mjxpbp11:empty($activityType))</b:condition>
                            <b:sequence>
                                <b:if name="Execute the activity depending on the type">
                                    <b:condition>$activityType/core:implementationType='3'</b:condition>
                                    <b:scope name="Handle Human Tasks">
                                        <b:variables>
                                            <b:variable messageType="core:initTaskAdvancedRequestMessage" name="initTaskRequestMessage"/>
                                            <b:variable messageType="core:initTaskAdvancedResponseMessage" name="initTaskResponseMessage"/>
                                            <b:variable messageType="core:canPerformRequestMessage" name="canPerformRequestMessage"/>
                                            <b:variable messageType="core:canPerformResponseMessage" name="canPerformResponseMessage"/>
                                            <b:variable element="core:taskInitiationException" name="taskInitiationException"/>
                                        </b:variables>
                                        <b:sequence name="Handle Human Task activities">
                                            <b:scope name="Initiate Task">
                                                <b:variables>
                                                    <b:variable element="core:taskInitiationException" name="currentExceptionInternal"/>
                                                </b:variables>
                                                <b:faultHandlers>
                                                    <b:catch faultName="core:taskInitiationException">
                                                        <b:sequence name="FailedToInitiateTask">
                                                            <b:assign name="ExtractFault">
                                                                <b:copy ignoreMissingFromData="yes">
                                                                    <b:from variable="currentExceptionInternal"/>
                                                                    <b:to variable="taskInitiationException"/>
                                                                </b:copy>
                                                            </b:assign>
                                                        </b:sequence>
                                                    </b:catch>
                                                </b:faultHandlers>
                                                <b:sequence>
                                                    <b:assign name="Initialise Init task message">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:query>false()</b:query>
                        											</b:from>
                                                            <b:to variable="taskInitiationFailed"/>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>mjxpbp11:instantiateMessage('initTaskRequestMessage')</b:from>
                                                            <b:to variable="initTaskRequestMessage">
                                                                <b:query/>
                                                    </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activityType">
                                                                <b:query>core:taskName</b:query>
														</b:from>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:taskName</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="currentUser"/>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:initiator</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from part="parameters" variable="invokeRequest">
                                                                <b:query>core:businessProcessData</b:query>
														</b:from>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:inputData</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="activity">
                                                                <b:query>core:priority</b:query>
														</b:from>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:inputData/core:taskData/core:priority</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="activity">
                                                                <b:query>core:peopleGroupEvaluator</b:query>
														</b:from>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:inputData/core:taskData/core:peopleGroupEvaluator</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="activityType">
                                                                <b:query>core:applicationProcessId</b:query>
                                                    </b:from>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:inputData/core:taskData/core:applicationProcessId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
                                                    </b:from>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:inputData/core:taskData/core:activityId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="currentUser"/>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:canPerformUser</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:query>mjxpbp11:generateGUID()</b:query>
                                                            </b:from>
                                                            <b:to part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:taskInstanceId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:assign name="Set task id as the activity reference">
                                                        <b:copy>
                                                            <b:from part="parameters" variable="initTaskRequestMessage">
                                                                <b:query>core:taskInstanceId</b:query>
                                                            </b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:lastActivityReference</b:query>
                                                    </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:scope name="RecordTaskStarted">
                                                        <wb:vinfo xywh="320,86,150,50" minimized="true"/>
                                                        <b:variables>
                                                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                            <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                            <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                            <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                            <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                                            <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                        </b:variables>
                                                        <b:sequence>
                                                            <b:assign name="Prepare action input">
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>ACTIVITY_START</b:literal>
													</b:from>
                                                                    <b:to variable="eventType">
                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                    <b:to part="parameters" variable="actionInput">
                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;    
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
																</b:literal>
		                                                	</b:from>
                                                                    <b:to variable="invokeActionInput">
                    </b:to>
                                                                </b:copy>
                                                                <b:copy ignoreMissingFromData="yes">
                                                                    <b:from variable="businessProcessData"/>
                                                                    <b:to variable="invokeActionInput">
                                                                        <b:query>enactor.core.business.process.BusinessProcessData</b:query>
		                                                	</b:to>
                                                                </b:copy>
                                                                <b:copy ignoreMissingFromData="yes">
                                                                    <b:from variable="activity"/>
                                                                    <b:to variable="invokeActionInput">
                                                                        <b:query>enactor.core.business.process.Activity</b:query>
	                                                	</b:to>
                                                                </b:copy>
                                                                <b:copy ignoreMissingFromData="yes">
                                                                    <b:from variable="activityType"/>
                                                                    <b:to variable="invokeActionInput">
                                                                        <b:query>enactor.core.business.process.ActivityType</b:query>
	                                                	</b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="eventType"/>
                                                                    <b:to variable="invokeActionInput">
                                                                        <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
		                                                	</b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="activity">
                                                                        <b:query>string(core:activityId)</b:query>
		                                                	</b:from>
                                                                    <b:to variable="invokeActionInput">
                                                                        <b:query>enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
		                                                	</b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction</b:literal>
															</b:from>
                                                                    <b:to part="parameters" variable="actionInput">
                                                                        <b:query>core:actionClassName</b:query>
													</b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="invokeActionInput"/>
                                                                    <b:to part="parameters" variable="actionInput">
                                                                        <b:query>core:inputData</b:query>
													</b:to>
                                                                </b:copy>
                                                            </b:assign>
                                                            <b:extensionActivity name="Open session">
                                                                <core:openDataAccessSession supressJoinFailure="no"/>
                                                            </b:extensionActivity>
                                                            <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                                            <b:extensionActivity name="Close session">
                                                                <core:closeDataAccessSession supressJoinFailure="no"/>
                                                            </b:extensionActivity>
                                                        </b:sequence>
                                                    </b:scope>
                                                    <b:scope name="Evaluate activation and Timeout">
                                                        <b:variables>
                                                            <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                            <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                        </b:variables>
                                                        <b:sequence name="EvaluateActivationAndTimeouts">
                                                            <b:assign name="CreateInput">
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                                    </b:from>
                                                                    <b:to part="parameters" variable="actionInputMessage"/>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns12="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="http://maven.apache.org/POM/4.0.0" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:ns6="tools" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="enactor.core.business.process.HumanTaskActivity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IHumanTaskActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type required="true" name="enactor.core.business.process.HumanTaskActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IHumanTaskActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                                    </b:from>
                                                                    <b:to part="parameters" variable="actionInputMessage">
                                                                        <b:query>core:inputData</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>com.enactor.bpel.rt.business.process.EvaluateHumanTaskActivationAndDeadlineTimesAction</b:literal>
                                                                    </b:from>
                                                                    <b:to part="parameters" variable="actionInputMessage">
                                                                        <b:query>core:actionClassName</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="businessProcessData"/>
                                                                    <b:to part="parameters" variable="actionInputMessage">
                                                                        <b:query>core:inputData/enactor.core.business.process.BusinessProcessData</b:query>
																	</b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="activity"/>
                                                                    <b:to part="parameters" variable="actionInputMessage">
                                                                        <b:query>core:inputData/enactor.core.business.process.HumanTaskActivity</b:query>
																	</b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="activityType"/>
                                                                    <b:to part="parameters" variable="actionInputMessage">
                                                                        <b:query>core:inputData/enactor.core.business.process.HumanTaskActivityType</b:query>
																	</b:to>
                                                                </b:copy>
                                                            </b:assign>
                                                            <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                            <b:assign name="Extract results">
                                                                <b:copy>
                                                                    <b:from part="parameters" variable="actionOutputMessage">
                                                                        <b:query>core:invokeActionOutput/core:output/enactor.core.business.process.BusinessProcessData</b:query>
																	</b:from>
                                                                    <b:to variable="businessProcessData"/>
                                                                </b:copy>
                                                            </b:assign>
                                                        </b:sequence>
                                                    </b:scope>
                                                    <b:invoke operation="initTaskAdvanced" portType="TaskManagerPT" partnerLink="taskManager" outputVariable="initTaskResponseMessage" inputVariable="initTaskRequestMessage" name="TaskManager:intTask"/>
                                                </b:sequence>
                                            </b:scope>
                                            <b:if name="Handle Result">
                                                <b:condition>not(mjxpbp11:empty($initTaskResponseMessage.parameters/core:result/core:taskId))</b:condition>
                                                <b:sequence name="Successfully Initiated">
                                                    <b:assign name="Set task id as the activity reference">
                                                        <b:copy>
                                                            <b:from part="parameters" variable="initTaskResponseMessage">
                                                                <b:query>core:result/core:taskId</b:query>
                                                            </b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:lastActivityReference</b:query>
                                                    </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:assign name="Set can perform results">
                                                        <b:copy>
                                                            <b:from part="parameters" variable="initTaskResponseMessage">
                                                                <b:query>core:result/core:canPerformCheck</b:query>
                                                            </b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:taskData/core:canPerformNextTask</b:query>
                                                    </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from part="parameters" variable="initTaskResponseMessage">
                                                                <b:query>core:result/core:taskId</b:query>
                                                            </b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:taskData/core:nextTaskId</b:query>
                                                    </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:assign name="Set task app id and abstract">
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from part="parameters" variable="initTaskResponseMessage">
                                                                <b:query>core:result/core:taskAppId</b:query>
                                                            </b:from>
                                                            <b:to part="parameters" variable="invokeResponse">
                                                                <b:query>core:taskAppProcessId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from part="parameters" variable="initTaskResponseMessage">
                                                                <b:query>core:result/core:taskAbstract</b:query>
                                                            </b:from>
                                                            <b:to part="parameters" variable="invokeResponse">
                                                                <b:query>core:taskAbstract</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:assign name="Set exit to true">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:query>true()</b:query>
																</b:from>
                                                            <b:to variable="exit">
																</b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                </b:sequence>
                                                <b:elseif>
                                                    <b:condition>not(mjxpbp11:empty($taskInitiationException))</b:condition>
                                                    <b:sequence name="Got TaskInitiationException">
                                                        <b:sequence name="End HT Activity in Error">
                                                            <b:assign name="Prepare for next task">
                                                                <b:copy>
                                                                    <b:from variable="activity">
                                                                        <b:query>core:activityId</b:query>
                                                                    </b:from>
                                                                    <b:to variable="businessProcessData">
                                                                        <b:query>core:lastActivityId</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="activity">
                                                                        <b:query>core:activityId</b:query>
        </b:from>
                                                                    <b:to variable="lastActivityId"/>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                    <b:to variable="businessProcessData">
                                                                        <b:query>core:lastActivityOutcome</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                    <b:to variable="lastActivityOutcome"/>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from part="parameters" variable="initTaskRequestMessage">
                                                                        <b:query>core:taskInstanceId</b:query>
                                                                    </b:from>
                                                                    <b:to variable="businessProcessData">
                                                                        <b:query>core:lastActivityReference</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:query>true()</b:query>
                        											</b:from>
                                                                    <b:to variable="taskInitiationFailed"/>
                                                                </b:copy>
                                                            </b:assign>
                                                        </b:sequence>
                                                        <b:scope name="Log Error">
                                                            <b:variables>
                                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                            </b:variables>
                                                            <b:sequence name="Log Error">
                                                                <b:assign name="CreateInput">
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage"/>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns11="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://maven.apache.org/POM/4.0.0" xmlns:ns15="http://www.enactor.com/core/bpel" xmlns:retail="http://www.enactor.com/retail" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.LogEntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.Integer&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ProcessId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.EntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ReferenceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.Message"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="Exception"&gt;
            &lt;core:interfaceName&gt;java.lang.Throwable&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>com.enactor.commonUI.actions.WriteBPActivityEventToAppProcessLogAction</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:actionClassName</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="instanceId"/>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.coreUI.ReferenceId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="instanceId"/>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="activity">
                                                                            <b:query>core:activityId</b:query>
                                                                        </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from part="parameters" variable="initTaskRequestMessage">
                                                                            <b:query>core:taskInstanceId</b:query>
                                                                        </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:query>number(0)</b:query>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.commonUI.logging.LogEntryType</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>Generic Activity Flow BPEL</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.coreUI.ProcessId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>businessProcess</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.commonUI.logging.EntryType</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:query>concat('Error initiating task. ActivityID=',$activity/core:activityId)</b:query>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.coreUI.Message</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="taskInitiationException"/>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/Exception</b:query>
                                                                        </b:to>
                                                                    </b:copy>
                                                                </b:assign>
                                                                <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                            </b:sequence>
                                                        </b:scope>
                                                    </b:sequence>
                                                </b:elseif>
                                                <b:else>
                                                    <b:sequence name="Unexpected Error">
                                                        <b:sequence name="End HT Activity in Error">
                                                            <b:assign name="Prepare for next task">
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:query>true()</b:query>
                        											</b:from>
                                                                    <b:to variable="taskInitiationFailed"/>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="activity">
                                                                        <b:query>core:activityId</b:query>
                                                                    </b:from>
                                                                    <b:to variable="businessProcessData">
                                                                        <b:query>core:lastActivityId</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from variable="activity">
                                                                        <b:query>core:activityId</b:query>
        </b:from>
                                                                    <b:to variable="lastActivityId">
                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                    <b:to variable="businessProcessData">
                                                                        <b:query>core:lastActivityOutcome</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from>
                                                                        <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                    <b:to variable="lastActivityOutcome">
                    </b:to>
                                                                </b:copy>
                                                                <b:copy>
                                                                    <b:from part="parameters" variable="initTaskRequestMessage">
                                                                        <b:query>core:taskInstanceId</b:query>
                                                                    </b:from>
                                                                    <b:to variable="businessProcessData">
                                                                        <b:query>core:lastActivityReference</b:query>
                                                                    </b:to>
                                                                </b:copy>
                                                            </b:assign>
                                                        </b:sequence>
                                                        <b:scope name="Log Error">
                                                            <b:variables>
                                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                            </b:variables>
                                                            <b:sequence name="Log Error">
                                                                <b:assign name="CreateInput">
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                        </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns11="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://maven.apache.org/POM/4.0.0" xmlns:ns15="http://www.enactor.com/core/bpel" xmlns:retail="http://www.enactor.com/retail" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.LogEntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.Integer&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ProcessId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.EntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ReferenceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.Message"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>com.enactor.commonUI.actions.WriteBPActivityEventToAppProcessLogAction</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:actionClassName</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="instanceId"/>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.coreUI.ReferenceId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="instanceId"/>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="activity">
                                                                            <b:query>core:activityId</b:query>
                                                                        </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from part="parameters" variable="initTaskRequestMessage">
                                                                            <b:query>core:taskInstanceId</b:query>
                                                                        </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:query>number(0)</b:query>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.commonUI.logging.LogEntryType</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>Generic Activity Flow BPEL</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.coreUI.ProcessId</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>businessProcess</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.commonUI.logging.EntryType</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:query>concat('Error initiating task. ActivityID=',$activity/core:activityId)</b:query>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInputMessage">
                                                                            <b:query>core:inputData/enactor.coreUI.Message</b:query>
                                                            </b:to>
                                                                    </b:copy>
                                                                </b:assign>
                                                                <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                            </b:sequence>
                                                        </b:scope>
                                                    </b:sequence>
                                                </b:else>
                                            </b:if>
                                        </b:sequence>
                                    </b:scope>
                                    <b:elseif>
                                        <b:condition>$activityType/core:implementationType='1' or $activityType/core:implementationType='5' or $activityType/core:implementationType='8'</b:condition>
                                        <b:scope name="Handle Actions">
                                            <b:variables>
                                                <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                            </b:variables>
                                            <b:sequence name="Handle Actions">
                                                <b:assign name="SetActionReference">
                                                    <b:copy>
                                                        <b:from>
                                                            <b:query>mjxpbp11:generateGUID()</b:query>
                                                        </b:from>
                                                        <b:to variable="businessProcessData">
                                                            <b:query>core:lastActivityReference</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                </b:assign>
                                                <b:scope name="RecordActionStarted">
                                                    <wb:vinfo xywh="160,72,150,50" minimized="true"/>
                                                    <b:variables>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                        <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                        <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                        <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                        <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                                        <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                    </b:variables>
                                                    <b:sequence>
                                                        <b:assign name="Prepare action input">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>ACTIVITY_START</b:literal>
													</b:from>
                                                                <b:to variable="eventType"/>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                                </b:from>
                                                                <b:to part="parameters" variable="actionInput"/>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>
	&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
		&lt;core:dataItem&gt;
	        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
	            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;	    
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
	&lt;/core:xmlApplicationProcessData&gt;
																	</b:literal>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput"/>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="businessProcessData"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.BusinessProcessData</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activity"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.Activity</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activityType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.ActivityType</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="eventType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="activity">
                                                                    <b:query>string(core:activityId)</b:query>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
											</b:literal>
													</b:from>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:actionClassName</b:query>
													</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="invokeActionInput"/>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:inputData</b:query>
													</b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:extensionActivity name="Open session">
                                                            <core:openDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                        <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                                        <b:extensionActivity name="Close session">
                                                            <core:closeDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                    </b:sequence>
                                                </b:scope>
                                                <b:sequence name="Handle Actions">
                                                    <b:assign name="Initialize Input">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInput"/>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.ActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.core.business.process.InvokeServerAction"&gt;
            &lt;core:interfaceName&gt;java.lang.Boolean&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
																</b:literal>
		                                                	</b:from>
                                                            <b:to variable="invokeActionInput"/>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="businessProcessData"/>
                                                            <b:to variable="invokeActionInput">
                                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activityType"/>
                                                            <b:to variable="invokeActionInput">
                                                                <b:query>enactor.core.business.process.ActivityType</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activity"/>
                                                            <b:to variable="invokeActionInput">
                                                                <b:query>enactor.core.business.process.Activity</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:query>true()</b:query>
                                                            </b:from>
                                                            <b:to variable="invokeActionInput">
                                                                <b:query>enactor.core.business.process.InvokeServerAction</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activityType">
                                                                <b:query>core:actionClassName</b:query>
															</b:from>
                                                            <b:to part="parameters" variable="actionInput">
                                                                <b:query>core:actionClassName</b:query>
															</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="invokeActionInput"/>
                                                            <b:to part="parameters" variable="actionInput">
                                                                <b:query>core:inputData</b:query>
															</b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke Action Activity"/>
                                                    <b:assign name="Extract results">
                                                        <b:copy>
                                                            <b:from part="parameters" variable="actionOutput">
                                                                <b:query>core:invokeActionOutput/core:output</b:query>
															</b:from>
                                                            <b:to variable="invokeActionOutput"/>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="invokeActionOutput">
                                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                            </b:from>
                                                            <b:to variable="businessProcessData"/>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:assign name="Prepare for next activity">
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="lastActivityId"/>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:lastActivityId</b:query>
                                                        </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="businessProcessData">
                                                                <b:query>core:lastActivityOutcome</b:query>
															</b:from>
                                                            <b:to variable="lastActivityOutcome"/>
                                                        </b:copy>
                                                    </b:assign>
                                                </b:sequence>
                                            </b:sequence>
                                        </b:scope>
                                    </b:elseif>
                                    <b:elseif>
                                        <b:condition>$activityType/core:implementationType='4' or $activityType/core:implementationType='11'</b:condition>
                                        <b:scope name="Handle Application Process">
                                            <b:variables>
                                                <b:variable messageType="ns2:invokeProcessRequestMessage" name="requestMessage"/>
                                                <b:variable element="core:xmlApplicationProcessData" name="inputData"/>
                                                <b:variable element="core:invokeProcessServiceMessage" name="operationInput"/>
                                                <b:variable messageType="ns2:invokeProcessResponseMessage" name="responseMessage"/>
                                                <b:variable element="core:invokeProcessServiceResponse" name="operationOutput"/>
                                                <b:variable element="core:xmlApplicationProcessData" name="outputData"/>
                                            </b:variables>
                                            <b:sequence name="Handle Application Process">
                                                <b:assign name="SetAppProcessReference">
                                                    <b:copy>
                                                        <b:from>
                                                            <b:query>mjxpbp11:generateGUID()</b:query>
                                                        </b:from>
                                                        <b:to variable="businessProcessData">
                                                            <b:query>core:lastActivityReference</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                </b:assign>
                                                <b:scope name="RecordAppProcessStarted">
                                                    <wb:vinfo xywh="160,199,150,50" minimized="true"/>
                                                    <b:variables>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                        <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                        <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                        <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                        <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                                        <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                    </b:variables>
                                                    <b:sequence>
                                                        <b:assign name="Prepare action input">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>ACTIVITY_START</b:literal>
													</b:from>
                                                                <b:to variable="eventType"/>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                                </b:from>
                                                                <b:to part="parameters" variable="actionInput"/>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>
	&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
		&lt;core:dataItem&gt;
	        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
	            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;	    
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
	&lt;/core:xmlApplicationProcessData&gt;
																	</b:literal>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput"/>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="businessProcessData"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.BusinessProcessData</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activity"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.Activity</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activityType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.ActivityType</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="eventType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="activity">
                                                                    <b:query>string(core:activityId)</b:query>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
											</b:literal>
													</b:from>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:actionClassName</b:query>
													</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="invokeActionInput"/>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:inputData</b:query>
													</b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:extensionActivity name="Open session">
                                                            <core:openDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                        <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                                        <b:extensionActivity name="Close session">
                                                            <core:closeDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                    </b:sequence>
                                                </b:scope>
                                                <b:sequence name="Handle Application Process">
                                                    <b:assign name="Initialize Input">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>
&lt;execute xmlns="http://www.enactor.com/coreui/InvokeProcessService"&gt;
	&lt;core:invokeProcessServiceMessage xmlns:core="http://www.enactor.com/core"/&gt;	
&lt;/execute&gt;
                                                            </b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="requestMessage"/>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from part="parameters" variable="requestMessage">
                                                                <b:query>core:invokeProcessServiceMessage</b:query>
															</b:from>
                                                            <b:to variable="operationInput"/>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.ActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
																</b:literal>
		                                                	</b:from>
                                                            <b:to variable="inputData"/>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="businessProcessData"/>
                                                            <b:to variable="inputData">
                                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activityType"/>
                                                            <b:to variable="inputData">
                                                                <b:query>enactor.core.business.process.ActivityType</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activity"/>
                                                            <b:to variable="inputData">
                                                                <b:query>enactor.core.business.process.Activity</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>BusinessProcess/ServerProcessRunner</b:literal>
															</b:from>
                                                            <b:to variable="operationInput">
                                                                <b:query>core:processId</b:query>
															</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="inputData"/>
                                                            <b:to variable="operationInput">
                                                                <b:query>core:inputData</b:query>
															</b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:invoke operation="execute" portType="ns2:InvokeProcessServicePT" partnerLink="invokeApplicationProcess" outputVariable="responseMessage" inputVariable="requestMessage" name="Invoke Application Process"/>
                                                    <b:assign name="Extract results">
                                                        <b:copy>
                                                            <b:from part="parameters" variable="responseMessage">
                                                                <b:query>core:invokeProcessServiceResponse/core:outputData</b:query>
															</b:from>
                                                            <b:to variable="outputData"/>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="outputData">
                                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                            </b:from>
                                                            <b:to variable="businessProcessData">
															</b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:assign name="Prepare for next activity">
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="lastActivityId">
															</b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="businessProcessData">
                                                                <b:query>core:lastActivityOutcome</b:query>
															</b:from>
                                                            <b:to variable="lastActivityOutcome">
															</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:lastActivityId</b:query>
                                                        </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                </b:sequence>
                                                <b:if name="Run Scheduled Job">
                                                    <b:condition>$activityType/core:runSynchronously != 'true'</b:condition>
                                                    <b:sequence name="Set exit to true">
                                                        <b:assign name="Set exit to true">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:query>true()</b:query>
																</b:from>
                                                                <b:to variable="exit">
																</b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                    </b:sequence>
                                                    <b:else>
                                                        <b:scope name="Check if suspended">
                                                            <b:variables>
                                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                                <b:variable type="xsd:boolean" name="suspend" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                            </b:variables>
                                                            <b:sequence name="Check if suspended">
                                                                <b:sequence name="CheckBusinessProcessSuspendActivityOutcomeAction">
                                                                    <b:assign name="CreateInput">
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage"/>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns12="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://www.enactor.com/core/bpel" xmlns:ns6="http://maven.apache.org/POM/4.0.0" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityOutcome"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcess"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcess&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessID"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData</b:query>
                                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>com.enactor.commonUI.actions.CheckBusinessProcessSuspendActivityOutcomeAction</b:literal>
                                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:actionClassName</b:query>
                                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="lastActivityOutcome"/>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.business.process.BusinessProcessActivityOutcome</b:query>
                                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="processId"/>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.business.process.BusinessProcessID</b:query>
                                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="activity">
                                                                                <b:query>core:activityId</b:query>
                                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
                                                                            </b:to>
                                                                        </b:copy>
                                                                    </b:assign>
                                                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                                    <b:assign name="ExtractOutput">
                                                                        <b:copy>
                                                                            <b:from part="parameters" variable="actionOutputMessage">
                                                                                <b:query>core:invokeActionOutput/core:output/enactor.coreUI.business.process.Suspend</b:query>
                                                                            </b:from>
                                                                            <b:to variable="suspend"/>
                                                                        </b:copy>
                                                                    </b:assign>
                                                                    <b:if name="If Suspend">
                                                                        <wb:vinfo xywh="480,56,150,50" minimized="true"/>
                                                                        <b:condition>$suspend= 'true'</b:condition>
                                                                        <b:assign name="Set exit to true">
                                                                            <b:copy>
                                                                                <b:from>
                                                                                    <b:query>true()</b:query>
																</b:from>
                                                                                <b:to variable="exit">
																</b:to>
                                                                            </b:copy>
                                                                        </b:assign>
                                                                    </b:if>
                                                                </b:sequence>
                                                            </b:sequence>
                                                        </b:scope>
                                                    </b:else>
                                                </b:if>
                                            </b:sequence>
                                        </b:scope>
                                    </b:elseif>
                                    <b:elseif>
                                        <b:condition>$activityType/core:implementationType='7'</b:condition>
                                        <b:scope name="Handle Execute Business Process">
                                            <b:variables>
                                                <b:variable messageType="ns2:invokeProcessRequestMessage" name="requestMessage"/>
                                                <b:variable element="core:xmlApplicationProcessData" name="inputData"/>
                                                <b:variable element="core:invokeProcessServiceMessage" name="operationInput"/>
                                                <b:variable messageType="ns2:invokeProcessResponseMessage" name="responseMessage"/>
                                                <b:variable element="core:invokeProcessServiceResponse" name="operationOutput"/>
                                                <b:variable element="core:xmlApplicationProcessData" name="outputData"/>
                                            </b:variables>
                                            <b:sequence name="Handle Execute Business Process">
                                                <b:assign name="setExecutedBPReference">
                                                    <b:copy>
                                                        <b:from>
                                                            <b:query>mjxpbp11:generateGUID()</b:query>
                                                        </b:from>
                                                        <b:to variable="businessProcessData">
                                                            <b:query>core:lastActivityReference</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                </b:assign>
                                                <b:scope name="RecordExecuteBPStarted">
                                                    <b:variables>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                        <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                        <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                        <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                        <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                                        <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                    </b:variables>
                                                    <b:sequence>
                                                        <b:assign name="Prepare action input">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>ACTIVITY_START</b:literal>
													</b:from>
                                                                <b:to variable="eventType">
                                </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                                </b:from>
                                                                <b:to part="parameters" variable="actionInput">
                                </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>
	&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
		&lt;core:dataItem&gt;
	        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
	            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
	&lt;/core:xmlApplicationProcessData&gt;
																	</b:literal>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput">
                                </b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="businessProcessData"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.BusinessProcessData</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activity"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.Activity</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activityType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.ActivityType</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="eventType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="activity">
                                                                    <b:query>string(core:activityId)</b:query>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
											</b:literal>
													</b:from>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:actionClassName</b:query>
													</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="invokeActionInput"/>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:inputData</b:query>
													</b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:extensionActivity name="Open session">
                                                            <core:openDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                        <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                                        <b:extensionActivity name="Close session">
                                                            <core:closeDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                    </b:sequence>
                                                </b:scope>
                                                <b:sequence name="Handle Execute Business Process">
                                                    <b:assign name="Initialize Input">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>
&lt;execute xmlns="http://www.enactor.com/coreui/InvokeProcessService"&gt;
	&lt;core:invokeProcessServiceMessage xmlns:core="http://www.enactor.com/core"/&gt;	
&lt;/execute&gt;
                                                            </b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="requestMessage">
                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from part="parameters" variable="requestMessage">
                                                                <b:query>core:invokeProcessServiceMessage</b:query>
															</b:from>
                                                            <b:to variable="operationInput">
                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.ActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
																</b:literal>
		                                                	</b:from>
                                                            <b:to variable="inputData">
                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="businessProcessData"/>
                                                            <b:to variable="inputData">
                                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activityType"/>
                                                            <b:to variable="inputData">
                                                                <b:query>enactor.core.business.process.ActivityType</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activity"/>
                                                            <b:to variable="inputData">
                                                                <b:query>enactor.core.business.process.Activity</b:query>
		                                                	</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>BusinessProcess/ExecuteBusinessProcessRunner</b:literal>
															</b:from>
                                                            <b:to variable="operationInput">
                                                                <b:query>core:processId</b:query>
															</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="inputData"/>
                                                            <b:to variable="operationInput">
                                                                <b:query>core:inputData</b:query>
															</b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:invoke operation="execute" portType="ns2:InvokeProcessServicePT" partnerLink="invokeApplicationProcess" outputVariable="responseMessage" inputVariable="requestMessage" name="Invoke Application Process"/>
                                                    <b:assign name="Extract results">
                                                        <b:copy>
                                                            <b:from part="parameters" variable="responseMessage">
                                                                <b:query>core:invokeProcessServiceResponse/core:outputData</b:query>
															</b:from>
                                                            <b:to variable="outputData">
                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="outputData">
                                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                            </b:from>
                                                            <b:to variable="businessProcessData">
															</b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:assign name="Prepare for next activity">
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="lastActivityId">
															</b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="businessProcessData">
                                                                <b:query>core:lastActivityOutcome</b:query>
															</b:from>
                                                            <b:to variable="lastActivityOutcome">
															</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:lastActivityId</b:query>
                                                        </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                </b:sequence>
                                            </b:sequence>
                                        </b:scope>
                                    </b:elseif>
                                    <b:elseif>
                                        <b:condition>$activityType/core:implementationType='9'</b:condition>
                                        <b:scope name="Handle Start Activity">
                                            <b:sequence name="Handle Start Activity">
                                                <b:assign name="SetStartActivityReference">
                                                    <b:copy>
                                                        <b:from>
                                                            <b:query>mjxpbp11:generateGUID()</b:query>
                                                        </b:from>
                                                        <b:to variable="businessProcessData">
                                                            <b:query>core:lastActivityReference</b:query>
                                                        </b:to>
                                                    </b:copy>
                                                </b:assign>
                                                <b:scope name="RecordStartActivity">
                                                    <b:variables>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                        <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                        <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                        <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                        <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                        <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                                        <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                    </b:variables>
                                                    <b:sequence>
                                                        <b:assign name="Prepare action input">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>ACTIVITY_START</b:literal>
													</b:from>
                                                                <b:to variable="eventType">
            </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                                </b:from>
                                                                <b:to part="parameters" variable="actionInput">
            </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>
	&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
		&lt;core:dataItem&gt;
	        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
	            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;	    
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
		&lt;core:dataItem&gt;		
	        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
	            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
	        &lt;/core:type&gt;
	    &lt;/core:dataItem&gt;
	&lt;/core:xmlApplicationProcessData&gt;
																	</b:literal>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput">
            </b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="businessProcessData"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.BusinessProcessData</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activity"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.Activity</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activityType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.core.business.process.ActivityType</b:query>
		                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="eventType"/>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="activity">
                                                                    <b:query>string(core:activityId)</b:query>
			                                                	</b:from>
                                                                <b:to variable="invokeActionInput">
                                                                    <b:query>enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
			                                                	</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
											</b:literal>
													</b:from>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:actionClassName</b:query>
													</b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="invokeActionInput"/>
                                                                <b:to part="parameters" variable="actionInput">
                                                                    <b:query>core:inputData</b:query>
													</b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:extensionActivity name="Open session">
                                                            <core:openDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                        <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                                        <b:extensionActivity name="Close session">
                                                            <core:closeDataAccessSession supressJoinFailure="no"/>
                                                        </b:extensionActivity>
                                                    </b:sequence>
                                                </b:scope>
                                                <b:sequence name="Handle Start Activity">
                                                    <b:assign name="Prepare for next activity">
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="lastActivityId">
															</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>Success</b:literal>
                                                            </b:from>
                                                            <b:to variable="lastActivityOutcome">
															</b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="activity">
                                                                <b:query>core:activityId</b:query>
															</b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:lastActivityId</b:query>
                                                        </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>Success</b:literal>
                                                            </b:from>
                                                            <b:to variable="businessProcessData">
                                                                <b:query>core:lastActivityOutcome</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                </b:sequence>
                                            </b:sequence>
                                        </b:scope>
                                    </b:elseif>
                                    <b:elseif>
                                        <b:condition>$activityType/core:implementationType='10'</b:condition>
                                        <b:scope name="Handle Human Notifications">
                                            <b:variables>
                                                <b:variable messageType="core:initNotificationRequestMessage" name="initNotificationRequestMessage"/>
                                                <b:variable messageType="core:initNotificationResponseMessage" name="initNotificationResponseMessage"/>
                                                <b:variable element="core:taskInitiationException" name="taskInitiationException"/>
                                            </b:variables>
                                            <b:sequence name="Handle Human Notification activities">
                                                <b:scope name="Initiate Task">
                                                    <b:variables>
                                                        <b:variable element="core:taskInitiationException" name="currentExceptionInternal"/>
                                                    </b:variables>
                                                    <b:faultHandlers>
                                                        <b:catch faultName="core:taskInitiationException">
                                                            <b:sequence name="FailedToInitiateTask">
                                                                <b:assign name="ExtractFault">
                                                                    <b:copy ignoreMissingFromData="yes">
                                                                        <b:from variable="currentExceptionInternal"/>
                                                                        <b:to variable="taskInitiationException"/>
                                                                    </b:copy>
                                                                </b:assign>
                                                            </b:sequence>
                                                        </b:catch>
                                                    </b:faultHandlers>
                                                    <b:sequence>
                                                        <b:assign name="Initialise Init notification message">
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:query>false()</b:query>
                        											</b:from>
                                                                <b:to variable="taskInitiationFailed"/>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>mjxpbp11:instantiateMessage('initNotificationRequestMessage')</b:from>
                                                                <b:to variable="initNotificationRequestMessage"/>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="activityType">
                                                                    <b:query>core:taskName</b:query>
														</b:from>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:notificationName</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="currentUser"/>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:initiator</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from part="parameters" variable="invokeRequest">
                                                                    <b:query>core:businessProcessData</b:query>
														</b:from>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:inputData</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activity">
                                                                    <b:query>core:priority</b:query>
														</b:from>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:inputData/core:taskData/core:priority</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activity">
                                                                    <b:query>core:peopleGroupEvaluator</b:query>
														</b:from>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:inputData/core:taskData/core:peopleGroupEvaluator</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activityType">
                                                                    <b:query>core:applicationProcessId</b:query>
                                                    </b:from>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:inputData/core:taskData/core:applicationProcessId</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                            <b:copy ignoreMissingFromData="yes">
                                                                <b:from variable="activity">
                                                                    <b:query>core:activityId</b:query>
                                                    </b:from>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:inputData/core:taskData/core:activityId</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:query>mjxpbp11:generateGUID()</b:query>
                                                            </b:from>
                                                                <b:to part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:instanceId</b:query>
                                                                </b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:assign name="Set notification id as the activity reference">
                                                            <b:copy>
                                                                <b:from part="parameters" variable="initNotificationRequestMessage">
                                                                    <b:query>core:instanceId</b:query>
                                                                </b:from>
                                                                <b:to variable="businessProcessData">
                                                                    <b:query>core:lastActivityReference</b:query>
                                                    </b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                        <b:scope name="RecordTaskStarted">
                                                            <wb:vinfo xywh="320,57,150,50" minimized="true"/>
                                                            <b:variables>
                                                                <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                                                <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                                                <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                                                <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                                                <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                                                <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                                                <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                                            </b:variables>
                                                            <b:sequence>
                                                                <b:assign name="Prepare action input">
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>ACTIVITY_START</b:literal>
													</b:from>
                                                                        <b:to variable="eventType">
                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                        <b:to part="parameters" variable="actionInput">
                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;    
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
																</b:literal>
		                                                	</b:from>
                                                                        <b:to variable="invokeActionInput">
                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy ignoreMissingFromData="yes">
                                                                        <b:from variable="businessProcessData"/>
                                                                        <b:to variable="invokeActionInput">
                                                                            <b:query>enactor.core.business.process.BusinessProcessData</b:query>
		                                                	</b:to>
                                                                    </b:copy>
                                                                    <b:copy ignoreMissingFromData="yes">
                                                                        <b:from variable="activity"/>
                                                                        <b:to variable="invokeActionInput">
                                                                            <b:query>enactor.core.business.process.Activity</b:query>
	                                                	</b:to>
                                                                    </b:copy>
                                                                    <b:copy ignoreMissingFromData="yes">
                                                                        <b:from variable="activityType"/>
                                                                        <b:to variable="invokeActionInput">
                                                                            <b:query>enactor.core.business.process.ActivityType</b:query>
	                                                	</b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="eventType"/>
                                                                        <b:to variable="invokeActionInput">
                                                                            <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
		                                                	</b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="activity">
                                                                            <b:query>string(core:activityId)</b:query>
		                                                	</b:from>
                                                                        <b:to variable="invokeActionInput">
                                                                            <b:query>enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
		                                                	</b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction</b:literal>
															</b:from>
                                                                        <b:to part="parameters" variable="actionInput">
                                                                            <b:query>core:actionClassName</b:query>
													</b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="invokeActionInput"/>
                                                                        <b:to part="parameters" variable="actionInput">
                                                                            <b:query>core:inputData</b:query>
													</b:to>
                                                                    </b:copy>
                                                                </b:assign>
                                                                <b:extensionActivity name="Open session">
                                                                    <core:openDataAccessSession supressJoinFailure="no"/>
                                                                </b:extensionActivity>
                                                                <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                                                <b:extensionActivity name="Close session">
                                                                    <core:closeDataAccessSession supressJoinFailure="no"/>
                                                                </b:extensionActivity>
                                                            </b:sequence>
                                                        </b:scope>
                                                        <b:invoke operation="initNotification" portType="TaskManagerPT" partnerLink="taskManager" outputVariable="initNotificationResponseMessage" inputVariable="initNotificationRequestMessage" name="TaskManager:intTask"/>
                                                    </b:sequence>
                                                </b:scope>
                                                <b:if name="Handle Result">
                                                    <b:condition>not(mjxpbp11:empty($initNotificationResponseMessage.parameters/core:instanceId))</b:condition>
                                                    <b:sequence name="Successfully Initiated">
                                                        <b:assign name="Prepare for next activity">
                                                            <b:copy>
                                                                <b:from variable="activity">
                                                                    <b:query>core:activityId</b:query>
                                                                    </b:from>
                                                                <b:to variable="businessProcessData">
                                                                    <b:query>core:lastActivityId</b:query>
                                                                    </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from variable="activity">
                                                                    <b:query>core:activityId</b:query>
        </b:from>
                                                                <b:to variable="lastActivityId">
    </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>Sent</b:literal>
                                                                    </b:from>
                                                                <b:to variable="businessProcessData">
                                                                    <b:query>core:lastActivityOutcome</b:query>
                                                                    </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from>
                                                                    <b:literal>Sent</b:literal>
                                                                    </b:from>
                                                                <b:to variable="lastActivityOutcome">
    </b:to>
                                                            </b:copy>
                                                            <b:copy>
                                                                <b:from part="parameters" variable="initNotificationResponseMessage">
                                                                    <b:query>core:instanceId</b:query>
                                                                </b:from>
                                                                <b:to variable="businessProcessData">
                                                                    <b:query>core:lastActivityReference</b:query>
                                                                    </b:to>
                                                            </b:copy>
                                                        </b:assign>
                                                    </b:sequence>
                                                    <b:elseif>
                                                        <b:condition>not(mjxpbp11:empty($taskInitiationException))</b:condition>
                                                        <b:sequence name="Got TaskInitiationException">
                                                            <b:sequence name="End HT Activity in Error">
                                                                <b:assign name="Prepare for next task">
                                                                    <b:copy>
                                                                        <b:from variable="activity">
                                                                            <b:query>core:activityId</b:query>
                                                                    </b:from>
                                                                        <b:to variable="businessProcessData">
                                                                            <b:query>core:lastActivityId</b:query>
                                                                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="activity">
                                                                            <b:query>core:activityId</b:query>
        </b:from>
                                                                        <b:to variable="lastActivityId">
    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                        <b:to variable="businessProcessData">
                                                                            <b:query>core:lastActivityOutcome</b:query>
                                                                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                        <b:to variable="lastActivityOutcome">
    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from part="parameters" variable="initNotificationRequestMessage">
                                                                            <b:query>core:instanceId</b:query>
                                                                        </b:from>
                                                                        <b:to variable="businessProcessData">
                                                                            <b:query>core:lastActivityReference</b:query>
                                                                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:query>true()</b:query>
                        											</b:from>
                                                                        <b:to variable="taskInitiationFailed"/>
                                                                    </b:copy>
                                                                </b:assign>
                                                            </b:sequence>
                                                            <b:scope name="Log Error">
                                                                <b:variables>
                                                                    <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                    <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                                </b:variables>
                                                                <b:sequence name="Log Error">
                                                                    <b:assign name="CreateInput">
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
        </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns11="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://maven.apache.org/POM/4.0.0" xmlns:ns15="http://www.enactor.com/core/bpel" xmlns:retail="http://www.enactor.com/retail" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.LogEntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.Integer&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ProcessId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.EntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ReferenceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.Message"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="Exception"&gt;
            &lt;core:interfaceName&gt;java.lang.Throwable&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>com.enactor.commonUI.actions.WriteBPActivityEventToAppProcessLogAction</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:actionClassName</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="instanceId"/>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.ReferenceId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="instanceId"/>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="activity">
                                                                                <b:query>core:activityId</b:query>
                                                                        </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from part="parameters" variable="initNotificationRequestMessage">
                                                                                <b:query>core:instanceId</b:query>
                                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:query>number(0)</b:query>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.commonUI.logging.LogEntryType</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>Generic Activity Flow BPEL</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.ProcessId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>businessProcess</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.commonUI.logging.EntryType</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:query>concat('Error initiating notification. ActivityID=',$activity/core:activityId)</b:query>
                                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.Message</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="taskInitiationException"/>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/Exception</b:query>
                                                                        </b:to>
                                                                        </b:copy>
                                                                    </b:assign>
                                                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                                </b:sequence>
                                                            </b:scope>
                                                        </b:sequence>
                                                    </b:elseif>
                                                    <b:else>
                                                        <b:sequence name="Unexpected Error">
                                                            <b:sequence name="End HT Activity in Error">
                                                                <b:assign name="Prepare for next task">
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:query>true()</b:query>
                        											</b:from>
                                                                        <b:to variable="taskInitiationFailed"/>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="activity">
                                                                            <b:query>core:activityId</b:query>
                                                                    </b:from>
                                                                        <b:to variable="businessProcessData">
                                                                            <b:query>core:lastActivityId</b:query>
                                                                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from variable="activity">
                                                                            <b:query>core:activityId</b:query>
        </b:from>
                                                                        <b:to variable="lastActivityId">
                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                        <b:to variable="businessProcessData">
                                                                            <b:query>core:lastActivityOutcome</b:query>
                                                                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from>
                                                                            <b:literal>Error</b:literal>
                                                                    </b:from>
                                                                        <b:to variable="lastActivityOutcome">
                    </b:to>
                                                                    </b:copy>
                                                                    <b:copy>
                                                                        <b:from part="parameters" variable="initNotificationRequestMessage">
                                                                            <b:query>core:instanceId</b:query>
                                                                        </b:from>
                                                                        <b:to variable="businessProcessData">
                                                                            <b:query>core:lastActivityReference</b:query>
                                                                    </b:to>
                                                                    </b:copy>
                                                                </b:assign>
                                                            </b:sequence>
                                                            <b:scope name="Log Error">
                                                                <b:variables>
                                                                    <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                                    <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                                </b:variables>
                                                                <b:sequence name="Log Error">
                                                                    <b:assign name="CreateInput">
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                        </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns11="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://maven.apache.org/POM/4.0.0" xmlns:ns15="http://www.enactor.com/core/bpel" xmlns:retail="http://www.enactor.com/retail" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.LogEntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.Integer&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ProcessId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.EntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ReferenceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.Message"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>com.enactor.commonUI.actions.WriteBPActivityEventToAppProcessLogAction</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:actionClassName</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="instanceId"/>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.ReferenceId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="instanceId"/>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from variable="activity">
                                                                                <b:query>core:activityId</b:query>
                                                                        </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from part="parameters" variable="initNotificationRequestMessage">
                                                                                <b:query>core:instanceId</b:query>
                                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:query>number(0)</b:query>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.commonUI.logging.LogEntryType</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>Generic Activity Flow BPEL</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.ProcessId</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:literal>businessProcess</b:literal>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.commonUI.logging.EntryType</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                        <b:copy>
                                                                            <b:from>
                                                                                <b:query>concat('Error initiating task. ActivityID=',$activity/core:activityId)</b:query>
                                                            </b:from>
                                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                                <b:query>core:inputData/enactor.coreUI.Message</b:query>
                                                            </b:to>
                                                                        </b:copy>
                                                                    </b:assign>
                                                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                                </b:sequence>
                                                            </b:scope>
                                                        </b:sequence>
                                                    </b:else>
                                                </b:if>
                                            </b:sequence>
                                        </b:scope>
                                    </b:elseif>
                                    <b:else>
                                        <b:assign name="exit=true">
                                            <b:copy>
                                                <b:from>
                                                    <b:query>true()</b:query>
													</b:from>
                                                <b:to variable="exit">
													</b:to>
                                            </b:copy>
                                        </b:assign>
                                    </b:else>
                                </b:if>
                                <b:if name="IfDiscardExecuted">
                                    <b:condition>$activityType/core:implementationType='5' and $activity/core:discard = 'true'</b:condition>
                                    <b:assign name="isDiscard=true">
                                        <b:copy>
                                            <b:from>
                                                <b:query>true()</b:query>
                                            </b:from>
                                            <b:to variable="isDiscarded"/>
                                        </b:copy>
                                    </b:assign>
                                </b:if>
                            </b:sequence>
                            <b:else>
                                <b:if name="IfNotDiscarded">
                                    <b:condition>$isDiscarded = 'false'</b:condition>
                                    <b:scope name="Record process end since there are no more activities to execute">
                                        <b:variables>
                                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                                            <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                                            <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                                            <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                                            <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                                            <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                                        </b:variables>
                                        <b:sequence name="Record process end (no more activities)">
                                            <b:assign name="event=END_IN_ERROR">
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>PROCESS_END_IN_ERROR</b:literal>
													</b:from>
                                                    <b:to variable="eventType">
                    </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                    </b:from>
                                                    <b:to part="parameters" variable="actionInput">
                    </b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
														</b:literal>
                                                	</b:from>
                                                    <b:to variable="invokeActionInput"/>
                                                </b:copy>
                                                <b:copy ignoreMissingFromData="yes">
                                                    <b:from variable="businessProcessData"/>
                                                    <b:to variable="invokeActionInput">
                                                        <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                	</b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="eventType"/>
                                                    <b:to variable="invokeActionInput">
                                                        <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
                                                	</b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
											</b:literal>
													</b:from>
                                                    <b:to part="parameters" variable="actionInput">
                                                        <b:query>core:actionClassName</b:query>
													</b:to>
                                                </b:copy>
                                                <b:copy>
                                                    <b:from variable="invokeActionInput"/>
                                                    <b:to part="parameters" variable="actionInput">
                                                        <b:query>core:inputData</b:query>
													</b:to>
                                                </b:copy>
                                            </b:assign>
                                            <b:extensionActivity name="Open session">
                                                <core:openDataAccessSession supressJoinFailure="no"/>
                                            </b:extensionActivity>
                                            <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                            <b:extensionActivity name="Close session">
                                                <core:closeDataAccessSession supressJoinFailure="no"/>
                                            </b:extensionActivity>
                                            <b:scope name="Log Error">
                                                <b:variables>
                                                    <b:variable messageType="action:invokeActionRequestMessage" name="actionInputMessage"/>
                                                    <b:variable messageType="action:invokeActionResponseMessage" name="actionOutputMessage"/>
                                                </b:variables>
                                                <b:sequence name="Log Error">
                                                    <b:assign name="CreateInput">
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>&lt;core:invokeAction xmlns:core="http://www.enactor.com/core"/&gt;</b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage"/>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;core:xmlApplicationProcessData xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:bpel11="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:bpel20="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:core="http://www.enactor.com/core" xmlns:hta="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/api/200803" xmlns:htd="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/200803" xmlns:htt="http://docs.oasis-open.org/ns/bpel4people/ws-humantask/types/200803" xmlns:ns11="http://www.enactor.com/tools/bpel/wb/" xmlns:ns13="tools" xmlns:ns14="http://maven.apache.org/POM/4.0.0" xmlns:ns15="http://www.enactor.com/core/bpel" xmlns:retail="http://www.enactor.com/retail" xmlns:sref="http://docs.oasis-open.org/wsbpel/2.0/serviceref" xmlns:tools="http://www.enactor.com/tools"&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.LogEntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.Integer&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessInstanceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessActivityInstanceRef"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ProcessId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.commonUI.logging.EntryType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.ReferenceId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
    &lt;core:dataItem&gt;
        &lt;core:data xsi:type="core:WrappedNull" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/&gt;
        &lt;core:type name="enactor.coreUI.Message"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
</b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>com.enactor.commonUI.actions.WriteBPActivityEventToAppProcessLogAction</b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:actionClassName</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="instanceId"/>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.coreUI.ReferenceId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="instanceId"/>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessInstanceId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from variable="businessProcessData">
                                                                <b:query>core:lastActivityId</b:query>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy ignoreMissingFromData="yes">
                                                            <b:from variable="businessProcessData">
                                                                <b:query>core:lastActivityReference</b:query>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.core.business.process.BusinessProcessActivityInstanceRef</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:query>number(0)</b:query>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.commonUI.logging.LogEntryType</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>Generic Activity Flow BPEL</b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.coreUI.ProcessId</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:literal>businessProcess</b:literal>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.commonUI.logging.EntryType</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                        <b:copy>
                                                            <b:from>
                                                                <b:query>concat('Unhandled outcome error.ActivityID=',$businessProcessData/core:lastActivityId, '; Outcome=', $businessProcessData/core:lastActivityOutcome)</b:query>
                                                            </b:from>
                                                            <b:to part="parameters" variable="actionInputMessage">
                                                                <b:query>core:inputData/enactor.coreUI.Message</b:query>
                                                            </b:to>
                                                        </b:copy>
                                                    </b:assign>
                                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutputMessage" inputVariable="actionInputMessage" name="InvokeAction"/>
                                                </b:sequence>
                                            </b:scope>
                                        </b:sequence>
                                    </b:scope>
                                </b:if>
                            </b:else>
                        </b:if>
                    </b:sequence>
                    <b:condition>$exit or mjxpbp11:empty($activity) or mjxpbp11:empty($activityType) or $activityType/core:implementationType=5 or $activityType/core:implementationType=8</b:condition>
                </b:repeatUntil>
                <b:if name="Not discarded and process completed">
                    <b:condition>$isDiscarded = 'false' and not(mjxpbp11:empty($activityType)) and ($activityType/core:implementationType='5' or $activityType/core:implementationType='8')</b:condition>
                    <b:scope name="Record Activity and Process End">
                        <wb:vinfo xywh="0,0,150,50" minimized="true"/>
                        <b:variables>
                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                            <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                            <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                            <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                            <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                            <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                        </b:variables>
                        <b:sequence>
                            <wb:vinfo xywh="0,0,432,815" orientation="VERTICAL"/>
                            <b:sequence>
                                <b:sequence name="Record Activity End">
                                    <wb:vinfo xywh="0,115,172,515" orientation="VERTICAL"/>
                                    <b:assign name="Prepare action input">
                                        <b:copy>
                                            <b:from>
                                                <b:literal>ACTIVITY_END</b:literal>
													</b:from>
                                            <b:to variable="eventType">
                    </b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from>
                                                <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;
                                                    	</b:literal>
                                                    </b:from>
                                            <b:to part="parameters" variable="actionInput"/>
                                        </b:copy>
                                        <b:copy>
                                            <b:from>
                                                <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.Activity"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivity&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.ActivityType"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IActivityType&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;    
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
														</b:literal>
                                                	</b:from>
                                            <b:to variable="invokeActionInput"/>
                                        </b:copy>
                                        <b:copy ignoreMissingFromData="yes">
                                            <b:from variable="businessProcessData"/>
                                            <b:to variable="invokeActionInput">
                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                	</b:to>
                                        </b:copy>
                                        <b:copy ignoreMissingFromData="yes">
                                            <b:from variable="activity"/>
                                            <b:to variable="invokeActionInput">
                                                <b:query>enactor.core.business.process.Activity</b:query>
                                    	</b:to>
                                        </b:copy>
                                        <b:copy ignoreMissingFromData="yes">
                                            <b:from variable="activityType"/>
                                            <b:to variable="invokeActionInput">
                                                <b:query>enactor.core.business.process.ActivityType</b:query>
                                    	</b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from variable="eventType"/>
                                            <b:to variable="invokeActionInput">
                                                <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
                                                	</b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from>
                                                <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
									</b:literal>
											</b:from>
                                            <b:to part="parameters" variable="actionInput">
                                                <b:query>core:actionClassName</b:query>
											</b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from variable="invokeActionInput"/>
                                            <b:to part="parameters" variable="actionInput">
                                                <b:query>core:inputData</b:query>
											</b:to>
                                        </b:copy>
                                    </b:assign>
                                    <b:extensionActivity name="Open session">
                                        <core:openDataAccessSession supressJoinFailure="no"/>
                                    </b:extensionActivity>
                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                    <b:extensionActivity name="Close session">
                                        <core:closeDataAccessSession supressJoinFailure="no"/>
                                    </b:extensionActivity>
                                </b:sequence>
                                <b:sequence name="Record Process End">
                                    <wb:vinfo xywh="182,0,210,745" orientation="VERTICAL"/>
                                    <b:if name="If normal end">
                                        <b:condition>$activityType/core:implementationType=5</b:condition>
                                        <b:assign name="event=PROCESS_END">
                                            <b:copy>
                                                <b:from>
                                                    <b:literal>PROCESS_END</b:literal>
                                                </b:from>
                                                <b:to variable="eventType"/>
                                            </b:copy>
                                        </b:assign>
                                        <b:elseif>
                                            <b:condition>$activityType/core:implementationType=8</b:condition>
                                            <b:assign name="event=END_IN_ERROR">
                                                <b:copy>
                                                    <b:from>
                                                        <b:literal>PROCESS_END_IN_ERROR</b:literal>
                                                    </b:from>
                                                    <b:to variable="eventType">
            </b:to>
                                                </b:copy>
                                            </b:assign>
                                        </b:elseif>
                                    </b:if>
                                    <b:assign name="Prepare action input">
                                        <b:copy>
                                            <b:from>
                                                <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                                    </b:from>
                                            <b:to part="parameters" variable="actionInput">
                    </b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from>
                                                <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
														</b:literal>
                                                	</b:from>
                                            <b:to variable="invokeActionInput"/>
                                        </b:copy>
                                        <b:copy ignoreMissingFromData="yes">
                                            <b:from variable="businessProcessData"/>
                                            <b:to variable="invokeActionInput">
                                                <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                                	</b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from variable="eventType"/>
                                            <b:to variable="invokeActionInput">
                                                <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
                                                	</b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from>
                                                <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
											</b:literal>
													</b:from>
                                            <b:to part="parameters" variable="actionInput">
                                                <b:query>core:actionClassName</b:query>
													</b:to>
                                        </b:copy>
                                        <b:copy>
                                            <b:from variable="invokeActionInput"/>
                                            <b:to part="parameters" variable="actionInput">
                                                <b:query>core:inputData</b:query>
													</b:to>
                                        </b:copy>
                                    </b:assign>
                                    <b:extensionActivity name="Open session">
                                        <core:openDataAccessSession supressJoinFailure="no"/>
                                    </b:extensionActivity>
                                    <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                                    <b:extensionActivity name="Close session">
                                        <core:closeDataAccessSession supressJoinFailure="no"/>
                                    </b:extensionActivity>
                                </b:sequence>
                            </b:sequence>
                        </b:sequence>
                    </b:scope>
                </b:if>
                <b:scope name="ReplyIfRequired">
                    <b:if name="ReplyAfterProcessing">
                        <b:condition>$replySent = 'false'</b:condition>
                        <b:sequence>
                            <wb:vinfo xywh="0,0,170,268" orientation="VERTICAL"/>
                            <b:assign name="Prepare response">
                                <b:copy>
                                    <b:from variable="businessProcessData">
                                        <b:query/>
                                </b:from>
                                    <b:to part="parameters" variable="invokeResponse">
                                        <b:query>core:businessProcessData</b:query>
                            	</b:to>
                                </b:copy>
                            </b:assign>
                            <b:reply variable="invokeResponse" operation="invokeGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client" name="Reply"/>
                        </b:sequence>
                    </b:if>
                </b:scope>
            </b:sequence>
        </b:onMessage>
        <b:onMessage variable="timeoutRequest" operation="timeoutGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client">
            <b:scope>
                <b:sequence name="main">
                    <b:assign name="initialize input variables">
                        <b:copy>
                            <b:from part="parameters" variable="timeoutRequest">
                                <b:query>core:businessProcessData</b:query>
								</b:from>
                            <b:to variable="businessProcessData"/>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:processId)</b:query>
								</b:from>
                            <b:to variable="processId"/>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:lastActivityId)</b:query>
								</b:from>
                            <b:to variable="lastActivityId"/>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:lastActivityOutcome)
										</b:query>
								</b:from>
                            <b:to variable="lastActivityOutcome"/>
                        </b:copy>
                        <b:copy>
                            <b:from variable="businessProcessData">
                                <b:query>string(core:instanceId)</b:query>
								</b:from>
                            <b:to variable="instanceId"/>
                        </b:copy>
                    </b:assign>
                    <b:scope name="Load Business Process">
                        <b:variables>
                            <b:variable messageType="core:loadProcessRequestMessage" name="loadProcessRequest"/>
                            <b:variable messageType="core:loadProcessResponseMessage" name="loadProcessResponse"/>
                        </b:variables>
                        <b:if name="If processId available">
                            <b:condition>not(mjxpbp11:empty($processId))</b:condition>
                            <b:sequence name="Load Business process">
                                <wb:vinfo xywh="0,0,170,440" orientation="VERTICAL"/>
                                <b:assign name="PrepareEvaluateParamsRequest">
                                    <b:copy>
                                        <b:from>mjxpbp11:instantiateMessage('loadProcessRequest')</b:from>
                                        <b:to variable="loadProcessRequest">
                        </b:to>
                                    </b:copy>
                                    <b:copy>
                                        <b:from variable="processId"/>
                                        <b:to variable="loadProcessRequest">
                                            <b:query>core:processId</b:query>
                                        </b:to>
                                    </b:copy>
                                </b:assign>
                                <b:invoke operation="loadProcess" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="loadProcessResponse" inputVariable="loadProcessRequest" name="LoadProcess"/>
                                <b:assign name="ExtractData">
                                    <b:copy>
                                        <b:from part="parameters" variable="loadProcessResponse">
                                            <b:query>core:businessProcess</b:query>
                                        </b:from>
                                        <b:to variable="process">
                        </b:to>
                                    </b:copy>
                                </b:assign>
                            </b:sequence>
                        </b:if>
                    </b:scope>
                    <b:scope name="Get next activity">
                        <b:sequence>
                            <wb:vinfo xywh="0,0,170,468" orientation="VERTICAL"/>
                            <b:assign name="Prepare get next activity request" skipCloning="yes">
                                <b:copy>
                                    <b:from>mjxpbp11:instantiateMessage('getNextActivityRequest')
								</b:from>
                                    <b:to variable="getNextActivityRequest"/>
                                </b:copy>
                                <b:copy>
                                    <b:from variable="process"/>
                                    <b:to part="parameters" variable="getNextActivityRequest">
                                        <b:query>core:process</b:query>
										</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from variable="lastActivityId"/>
                                    <b:to part="parameters" variable="getNextActivityRequest">
                                        <b:query>core:lastActivityId</b:query>
										</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from variable="lastActivityOutcome"/>
                                    <b:to part="parameters" variable="getNextActivityRequest">
                                        <b:query>core:lastActivityOutcome</b:query>
										</b:to>
                                </b:copy>
                            </b:assign>
                            <b:invoke operation="getNextActivity" portType="businessProcessUtilServicePT" partnerLink="businessProcessUtil" outputVariable="getNextActivityResponse" inputVariable="getNextActivityRequest" name="Get Next Activity"/>
                            <b:assign name="Extract the activity">
                                <b:copy ignoreMissingFromData="yes">
                                    <b:from part="parameters" variable="getNextActivityResponse">
                                        <b:query>core:getNextActivityResult/core:nextActivity</b:query>
                                    </b:from>
                                    <b:to variable="activity"/>
                                </b:copy>
                            </b:assign>
                        </b:sequence>
                    </b:scope>
                    <b:sequence name="Set last outcome to Timeout">
                        <b:assign name="set Timeout">
                            <b:copy>
                                <b:from variable="activity">
                                    <b:query>core:activityId</b:query>
									</b:from>
                                <b:to variable="businessProcessData">
                                    <b:query>core:lastActivityId</b:query>
									</b:to>
                            </b:copy>
                            <b:copy>
                                <b:from>
                                    <b:literal>Timeout</b:literal>
									</b:from>
                                <b:to variable="businessProcessData">
                                    <b:query>core:lastActivityOutcome</b:query>
									</b:to>
                            </b:copy>
                        </b:assign>
                    </b:sequence>
                    <b:scope name="Record Activity End">
                        <b:variables>
                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionInput"/>
                            <b:variable messageType="action:invokeActionRequestMessage" name="actionInput"/>
                            <b:variable element="core:invokeAction" name="invokeActionRequest"/>
                            <b:variable messageType="action:invokeActionResponseMessage" name="actionOutput"/>
                            <b:variable element="core:invokeActionResponse" name="invokeActionResponse"/>
                            <b:variable element="core:xmlApplicationProcessData" name="invokeActionOutput"/>
                            <b:variable type="xsd:string" name="eventType" xmlns:xsd="http://www.w3.org/2001/XMLSchema"/>
                        </b:variables>
                        <b:sequence>
                            <wb:vinfo xywh="0,0,150,50" minimized="true"/>
                            <b:assign name="Prepare action input">
                                <b:copy>
                                    <b:from>
                                        <b:literal>ACTIVITY_END</b:literal>
										</b:from>
                                    <b:to variable="eventType"/>
                                </b:copy>
                                <b:copy>
                                    <b:from>
                                        <b:literal>&lt;invokeAction xmlns="http://www.enactor.com/core"/&gt;</b:literal>
                                    </b:from>
                                    <b:to part="parameters" variable="actionInput"/>
                                </b:copy>
                                <b:copy>
                                    <b:from>
                                        <b:literal>
&lt;core:xmlApplicationProcessData xmlns:core="http://www.enactor.com/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
	&lt;core:dataItem&gt;
        &lt;core:type name="enactor.core.business.process.BusinessProcessData"&gt;
            &lt;core:interfaceName&gt;com.enactor.core.business.process.IBusinessProcessData&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessEventType"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
	&lt;core:dataItem&gt;		
        &lt;core:type name="enactor.coreUI.business.process.BusinessProcessActivityId"&gt;
            &lt;core:interfaceName&gt;java.lang.String&lt;/core:interfaceName&gt;
        &lt;/core:type&gt;
    &lt;/core:dataItem&gt;
&lt;/core:xmlApplicationProcessData&gt;
										</b:literal>
                                  	</b:from>
                                    <b:to variable="invokeActionInput"/>
                                </b:copy>
                                <b:copy ignoreMissingFromData="yes">
                                    <b:from variable="businessProcessData"/>
                                    <b:to variable="invokeActionInput">
                                        <b:query>enactor.core.business.process.BusinessProcessData</b:query>
                                  	</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from variable="eventType"/>
                                    <b:to variable="invokeActionInput">
                                        <b:query>enactor.coreUI.business.process.BusinessProcessEventType</b:query>
                                  	</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from variable="activity">
                                        <b:query>string(core:activityId)</b:query>
                                  	</b:from>
                                    <b:to variable="invokeActionInput">
                                        <b:query>enactor.coreUI.business.process.BusinessProcessActivityId</b:query>
                                  	</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from>
                                        <b:literal>com.enactor.mfc.business.process.action.RecordBusinessProcessHistoryAction
											</b:literal>
										</b:from>
                                    <b:to part="parameters" variable="actionInput">
                                        <b:query>core:actionClassName</b:query>
										</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from variable="invokeActionInput"/>
                                    <b:to part="parameters" variable="actionInput">
                                        <b:query>core:inputData</b:query>
										</b:to>
                                </b:copy>
                            </b:assign>
                            <b:extensionActivity name="Open session">
                                <core:openDataAccessSession supressJoinFailure="no"/>
                            </b:extensionActivity>
                            <b:invoke operation="invokeAction" portType="action:InvokeActionServicePT" partnerLink="invokeAction" outputVariable="actionOutput" inputVariable="actionInput" name="Invoke RecordBusinessProcessEventAction"/>
                            <b:extensionActivity name="Close session">
                                <core:closeDataAccessSession supressJoinFailure="no"/>
                            </b:extensionActivity>
                        </b:sequence>
                    </b:scope>
                    <b:scope name="Call Generic Activity Flow">
                        <b:variables>
                            <b:variable messageType="core:invokeRequestMessage" name="invokeRequest"/>
                            <b:variable messageType="core:invokeResponseMessage" name="invokeResponse"/>
                        </b:variables>
                        <b:sequence>
                            <wb:vinfo xywh="0,0,170,321" orientation="VERTICAL"/>
                            <b:assign name="Prepare get next activity request">
                                <b:copy>
                                    <b:from>mjxpbp11:instantiateMessage('invokeRequest')</b:from>
                                    <b:to variable="invokeRequest">
										</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from variable="businessProcessData"/>
                                    <b:to part="parameters" variable="invokeRequest">
                                        <b:query>core:businessProcessData</b:query>
										</b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from>
                                        <b:literal>BPEL_RT_SYSTEM</b:literal>
                                    </b:from>
                                    <b:to part="parameters" variable="invokeRequest">
                                        <b:query>core:currentUser</b:query>
                                    </b:to>
                                </b:copy>
                                <b:copy>
                                    <b:from>
                                        <b:query>false()</b:query>
                                    </b:from>
                                    <b:to part="parameters" variable="invokeRequest">
                                        <b:query>core:isReRun</b:query>
                                    </b:to>
                                </b:copy>
                            </b:assign>
                            <b:invoke operation="invokeGenericActivityFlow" portType="GenericActivityFlowPT" partnerLink="genericActivityFlow" outputVariable="invokeResponse" inputVariable="invokeRequest" name="Invoke Generic Activity Flow"/>
                        </b:sequence>
                    </b:scope>
                    <b:scope name="Reply">
                        <b:sequence name="Reply">
                            <wb:vinfo xywh="0,0,170,255" orientation="VERTICAL"/>
                            <b:assign name="Prepare response">
                                <b:copy>
                                    <b:from>mjxpbp11:instantiateMessage('timeoutResponse')</b:from>
                                    <b:to variable="timeoutResponse"/>
                                </b:copy>
                            </b:assign>
                            <b:reply variable="timeoutResponse" operation="timeoutGenericActivityFlow" portType="core:GenericActivityFlowPT" partnerLink="client" name="Reply"/>
                        </b:sequence>
                    </b:scope>
                </b:sequence>
            </b:scope>
        </b:onMessage>
    </b:pick>
</b:process>
